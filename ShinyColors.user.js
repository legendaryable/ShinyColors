// ==UserScript==
// @name         偶像大师ShinyColors汉化
// @namespace    https://github.com/biuuu/ShinyColors
// @version      1.4.5
// @description  提交翻译或问题请到 https://github.com/biuuu/ShinyColors
// @icon         https://shinycolors.enza.fun/icon_192x192.png
// @author       biuuu
// @match        https://shinycolors.enza.fun/*
// @run-at       document-start
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @connect      api.interpreter.caiyunai.com
// @connect      translate.google.cn
// @connect      fanyi.baidu.com
// @updateURL    https://www.shiny.fun/ShinyColors.user.js
// @supportURL   https://github.com/biuuu/ShinyColors/issues
// ==/UserScript==
!function(){"use strict";const e=e=>"​"+e,t=e=>e.startsWith("​")?e.slice(1,e.length):e;var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var o="object"==typeof n&&n&&n.Object===Object&&n,a="object"==typeof self&&self&&self.Object===Object&&self,i=o||a||Function("return this")(),s=i.Symbol,c=Object.prototype,l=c.hasOwnProperty,u=c.toString,d=s?s.toStringTag:void 0;var f=function(e){var t=l.call(e,d),n=e[d];try{e[d]=void 0;var r=!0}catch(e){}var o=u.call(e);return r&&(t?e[d]=n:delete e[d]),o},p=Object.prototype.toString;var h=function(e){return p.call(e)},m=s?s.toStringTag:void 0;var y=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":m&&m in Object(e)?f(e):h(e)},v=Array.isArray;var g=function(e){return null!=e&&"object"==typeof e};var w=function(e){return"string"==typeof e||!v(e)&&g(e)&&"[object String]"==y(e)};var b=function(e){return!0===e||!1===e||g(e)&&"[object Boolean]"==y(e)};var _=function(e,t){return function(n){return e(t(n))}},E=_(Object.getPrototypeOf,Object),k=Function.prototype,S=Object.prototype,x=k.toString,j=S.hasOwnProperty,A=x.call(Object);var I=function(e){if(!g(e)||"[object Object]"!=y(e))return!1;var t=E(e);if(null===t)return!0;var n=j.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&x.call(n)==A};const C={origin:"https://www.shiny.fun",hash:"",localHash:"",version:"1.4.5",story:"normal",timeout:30,font1:"yuanti",font2:"heiti",auto:"off",bgm:"off",dev:!1},M=Object.assign({},C),R=["yuanti","heiti","yuanti2"],O={HEITI_JA:"UDKakugo_SmallPr6-B",HEITI_TRANS:"sczh-heiti,UDKakugo_SmallPr6-B",YUAN_JA:"HummingStd-E",YUAN_TRANS:"sczh-yuanti,HummingStd-E"},T=["origin","font1","font2","timeout","story","auto","bgm","dev"],P=T,D=()=>{O.HEITI_TRANS=`${R.includes(C.font2)?"sczh-":""}${C.font2},${O.HEITI_JA}`,O.YUAN_TRANS=`${R.includes(C.font1)?"sczh-":""}${C.font1},${O.YUAN_JA}`},z=()=>{const e={};P.forEach(t=>{C[t]!==M[t]&&(e[t]=C[t])}),D(),localStorage.setItem("sczh:setting",JSON.stringify(e))},$=()=>{let e=location.hash;e=e.slice(1).replace(/\?tdsourcetag=s_pc(tim|qq)_aiomsg/,""),e.split(";").forEach(e=>{let t=e.split("="),n=decodeURIComponent(t[0].trim()),r=t[1]?decodeURIComponent(t[1].trim()):"";n&&P.includes(n)&&(C[n]=r||M[n],z())})},F={auto:{on:"关闭机翻",off:"开启机翻",id:0,callback:()=>{C.auto="off"!==C.auto?"off":"on"}},story:{normal:"开启剧情提取",edit:"关闭剧情提取",id:0,callback:()=>{if("normal"===C.story)C.story="edit";else{const e=document.getElementById("btn-close-sczh");e?e.click():C.story="normal"}}},bgm:{on:"关闭BGM后台播放",off:"开启BGM后台播放",id:0,callback:()=>{C.bgm="off"!==C.bgm?"off":"on"}},origin:{id:0,title:"修改数据源",callback:()=>{const e=prompt("请输入数据源URL，清空则使用默认数据源",C.origin);null!==e&&(C.origin=e.trim())}},dev:{id:0,titles:["打开开发模式","关闭开发模式"],callback:()=>{C.dev=!C.dev}},update:{id:0,title:"检查更新",callback:()=>{window.open(C.origin+"/ShinyColors.user.js")}}},N=e=>{const t=C[e],n=F[e];let r="";if(b(t)){let e=t?1:0;r=n.titles[e]}else r=n.title||n[t];const o=n.id;o&&window.GM_unregisterMenuCommand(o),n.id=window.GM_registerMenuCommand(r,()=>{(0,n.callback)(),z(),L()})},L=()=>{if(!window.GM_registerMenuCommand||!window.GM_unregisterMenuCommand)return;["update","bgm","story","origin","auto","dev"].forEach(e=>{N(e)})};(()=>{const e=localStorage.getItem("sczh:setting");let t=JSON.parse(e);I(t)||(t={});const{origin:n}=t;/^https?:\/\//.test(n)&&(C.origin=n.trim()),P.forEach(e=>{let n=t[e];w(n)&&(n=n.trim()),(b(n)||n)&&(C[e]=n)}),D()})(),$(),L(),window.addEventListener("hashchange",$);const U=e=>{if(!e)return"";return e.replace(/[\u0020]+$/g,"").replace(/^[\u0020]+/g,"")},B=(e,t=!1)=>{let n=U(e).replace(/(\\r)?\\n/g,"\n").replace(/\\r/g,"\n");return t?n:n.replace(/\n{2,}/g,"\n")},H=e=>U(e).replace(/\r/g,"\n").replace(/\n{2,}/g,"\n"),q=e=>e.replace(/\?/g,"\\?").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)"),J=(...e)=>{C.dev&&console.info(...e)},W=(...e)=>{console.info(...e)},G=e=>w(e)?e.replace(/\r?\n/g,"\\n").replace(/\r/g,"\\n"):e,K=(e="0.0.0",t="0.0.0")=>{let n=!1;const r=e.split(".").map(e=>parseInt(e,10)),o=t.split(".").map(e=>parseInt(e,10));for(let e=0;e<r.length;e++){(r[e]||0)>(o[e]||0)&&(n=!0)}return n},Q=(e,t)=>{if(!e||!e.length)return e;let n=e,r=!1,o=((e=2)=>{let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(Math.floor(16*Math.random()+65520));return t})(3);Array.isArray(e)&&(n=e.join(o),r=!0);for(let[e,r]of t){if(!e||e.length<2)continue;const t=e.replace(/\./g,"\\.").replace(/\*/g,"\\*");n=n.replace(new RegExp(t,"g"),r)}return r?n.split(o):n},V=()=>{const e=new Map;return t=>{if(t&&!/^0+$/.test(t)&&"select"!==t){if(e.has(t)){const n=e.get(t);return e.set(t,n+1),`${t}-${n}`}e.set(t,0)}return t}},Y=(e,t)=>{try{if(t)return sessionStorage.setItem(e,JSON.stringify(t)),!0;{let t=sessionStorage.getItem(e);return JSON.parse(t)}}catch(e){}},X=new Map,Z=(e,t,n=[])=>{if(X.has(e))return X.get(e);let r=e;for(let[e,o]of t)r=r.replace(e,(...e)=>{let t=o;for(let r=1;r<e.length-2;r++){let o=e[r],a=!1;n.forEach(e=>{e.has(o)&&(t=t.replace("$"+r,e.get(o)),a=!0)}),a||(t=t.replace("$"+r,e[r]))}return t}),e.lastIndex=0;return X.set(e,r),r},ee=(t,n,r)=>{if(!t||!w(t[n]))return;const{expMap:o,wordMaps:a,textMap:i}=r,s=H(t[n]);let c=s;s&&((null==i?void 0:i.has(s))?t[n]=e(i.get(s)):(c=Z(s,o,a),s!==c&&(t[n]=e(c))))},{origin:te,version:ne}=C,re=async()=>{const e=Math.floor(Date.now()/1e3/60/60/6),t=await fetch(`${te}/manifest.json?t=${e}`);if(t.ok){const e=await t.json();return e.time=Date.now(),localStorage.setItem("sczh:manifest",JSON.stringify(e)),e}throw new Error(`${t.status} ${t.url}`)};let oe={data:null};const ae=new Promise((e,t)=>{(async()=>{let e;try{let t=localStorage.getItem("sczh:manifest");t&&(e=JSON.parse(t)),Date.now()-e.time>60*C.cacheTime*1e3&&(e=!1)}catch(e){}return e?K(ne,e.version)?e=await re():setTimeout(re,5e3):e=await re(),e})().then(t=>{oe.data=t,C.newVersion=t.version,C.hashes=t.hashes,e(t)}).catch(t)}),ie=async(e,t)=>{if(!t){const{hashes:n}=await ae;t=n[e.replace(/^\/(data\/)?/,"")]}return await(async e=>new Promise((t,n)=>{let r=setTimeout(()=>{n(`加载${e}超时`)},1e3*C.timeout);fetch(`${te}${e}`).then(e=>{if(clearTimeout(r),!e.ok)return n(`${e.status} ${e.url}`),"";const t=e.headers.get("content-type");return(null==t?void 0:t.includes("json"))?e.json():e.text()}).then(t).catch(n)}))(`${e}${t?"?v="+t:""}`)};var se=r((function(e,t){e.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},n=!t.document&&!!t.postMessage,r=n&&/blob:/i.test((t.location||{}).protocol),o={},a=0,i={parse:function(n,r){var s=(r=r||{}).dynamicTyping||!1;if(_(s)&&(r.dynamicTypingFunction=s,s={}),r.dynamicTyping=s,r.transform=!!_(r.transform)&&r.transform,r.worker&&i.WORKERS_SUPPORTED){var c=function(){if(!i.WORKERS_SUPPORTED)return!1;var n,r,s=(n=t.URL||t.webkitURL||null,r=e.toString(),i.BLOB_URL||(i.BLOB_URL=n.createObjectURL(new Blob(["(",r,")();"],{type:"text/javascript"})))),c=new t.Worker(s);return c.onmessage=y,c.id=a++,o[c.id]=c}();return c.userStep=r.step,c.userChunk=r.chunk,c.userComplete=r.complete,c.userError=r.error,r.step=_(r.step),r.chunk=_(r.chunk),r.complete=_(r.complete),r.error=_(r.error),delete r.worker,void c.postMessage({input:n,config:r,workerId:c.id})}var p=null;return"string"==typeof n?p=r.download?new l(r):new d(r):!0===n.readable&&_(n.read)&&_(n.on)?p=new f(r):(t.File&&n instanceof File||n instanceof Object)&&(p=new u(r)),p.stream(n)},unparse:function(e,t){var n=!1,r=!0,o=",",a="\r\n",s='"',c=s+s,l=!1,u=null;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||i.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(o=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(a=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+s)}}();var d=new RegExp(h(s),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,l);if("object"==typeof e[0])return p(u||f(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:f(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function f(e){if("object"!=typeof e)return[];var t=[];for(var n in e)t.push(n);return t}function p(e,t,n){var i="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&0<e.length,c=!Array.isArray(t[0]);if(s&&r){for(var l=0;l<e.length;l++)0<l&&(i+=o),i+=m(e[l],l);0<t.length&&(i+=a)}for(var u=0;u<t.length;u++){var d=s?e.length:t[u].length,f=!1,p=s?0===Object.keys(t[u]).length:0===t[u].length;if(n&&!s&&(f="greedy"===n?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===n&&s){for(var h=[],y=0;y<d;y++){var v=c?e[y]:y;h.push(t[u][v])}f=""===h.join("").trim()}if(!f){for(var g=0;g<d;g++){0<g&&!p&&(i+=o);var w=s&&c?e[g]:g;i+=m(t[u][w],g)}u<t.length-1&&(!n||0<d&&!p)&&(i+=a)}}return i}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var r=e.toString().replace(d,c);return"boolean"==typeof n&&n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||function(e,t){for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(r,i.BAD_DELIMITERS)||-1<r.indexOf(o)||" "===r.charAt(0)||" "===r.charAt(r.length-1)?s+r+s:r}}};if(i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="\ufeff",i.BAD_DELIMITERS=["\r","\n",'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!n&&!!t.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=m,i.ParserHandle=p,i.NetworkStreamer=l,i.FileStreamer=u,i.StringStreamer=d,i.ReadableStreamStreamer=f,t.jQuery){var s=t.jQuery;s.fn.parse=function(e){var n=e.config||{},r=[];return this.each((function(e){if("INPUT"!==s(this).prop("tagName").toUpperCase()||"file"!==s(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)r.push({file:this.files[o],inputElem:this,instanceConfig:s.extend({},n)})})),o(),this;function o(){if(0!==r.length){var t,n,o,c=r[0];if(_(e.before)){var l=e.before(c.file,c.inputElem);if("object"==typeof l){if("abort"===l.action)return t=c.file,n=c.inputElem,o=l.reason,void(_(e.error)&&e.error({name:"AbortError"},t,n,o));if("skip"===l.action)return void a();"object"==typeof l.config&&(c.instanceConfig=s.extend(c.instanceConfig,l.config))}else if("skip"===l)return void a()}var u=c.instanceConfig.complete;c.instanceConfig.complete=function(e){_(u)&&u(e,c.file,c.inputElem),a()},i.parse(c.file,c.instanceConfig)}else _(e.complete)&&e.complete()}function a(){r.splice(0,1),o()}}}function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=w(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new p(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,n){if(this.isFirstChunk&&_(this._config.beforeFirstChunk)){var o=this._config.beforeFirstChunk(e);void 0!==o&&(e=o)}this.isFirstChunk=!1,this._halted=!1;var a=this._partialLine+e;this._partialLine="";var s=this._handle.parse(a,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var c=s.meta.cursor;this._finished||(this._partialLine=a.substring(c-this._baseIndex),this._baseIndex=c),s&&s.data&&(this._rowCount+=s.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)t.postMessage({results:s,workerId:i.WORKER_ID,finished:l});else if(_(this._config.chunk)&&!n){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);s=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!l||!_(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(e){_(this._config.error)?this._config.error(e):r&&this._config.error&&t.postMessage({workerId:i.WORKER_ID,error:e,finished:!1})}}function l(e){var t;(e=e||{}).chunkSize||(e.chunkSize=i.RemoteChunkSize),c.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),n||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var r in e)t.setRequestHeader(r,e[r])}if(this._config.chunkSize){var o=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+o)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}n&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function u(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=i.LocalChunkSize),c.call(this,e);var r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var o=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,o)}var a=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function f(e){c.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=b((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=b((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=b((function(){this._streamCleanUp(),r=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(e){var t,n,r,o=Math.pow(2,53),a=-o,s=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,c=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,l=this,u=0,d=0,f=!1,p=!1,y=[],v={data:[],errors:[],meta:{}};if(_(e.step)){var g=e.step;e.step=function(t){if(v=t,k())E();else{if(E(),0===v.data.length)return;u+=t.data.length,e.preview&&u>e.preview?n.abort():(v.data=v.data[0],g(v,l))}}}function b(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function E(){if(v&&r&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines)for(var t=0;t<v.data.length;t++)b(v.data[t])&&v.data.splice(t--,1);return k()&&function(){if(v)if(Array.isArray(v.data[0])){for(var t=0;k()&&t<v.data.length;t++)v.data[t].forEach(n);v.data.splice(0,1)}else v.data.forEach(n);function n(t){_(e.transformHeader)&&(t=e.transformHeader(t)),y.push(t)}}(),function(){if(!v||!e.header&&!e.dynamicTyping&&!e.transform)return v;function t(t,n){var r,o=e.header?{}:[];for(r=0;r<t.length;r++){var a=r,i=t[r];e.header&&(a=r>=y.length?"__parsed_extra":y[r]),e.transform&&(i=e.transform(i,a)),i=S(a,i),"__parsed_extra"===a?(o[a]=o[a]||[],o[a].push(i)):o[a]=i}return e.header&&(r>y.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+y.length+" fields but parsed "+r,d+n):r<y.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+y.length+" fields but parsed "+r,d+n)),o}var n=1;return!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(t),n=v.data.length):v.data=t(v.data,0),e.header&&v.meta&&(v.meta.fields=y),d+=n,v}()}function k(){return e.header&&0===y.length}function S(t,n){return r=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[r]&&(e.dynamicTyping[r]=e.dynamicTypingFunction(r)),!0===(e.dynamicTyping[r]||e.dynamicTyping)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(function(e){if(s.test(e)){var t=parseFloat(e);if(a<t&&t<o)return!0}return!1}(n)?parseFloat(n):c.test(n)?new Date(n):""===n?null:n):n;var r}function x(e,t,n,r){var o={type:e,code:t,message:n};void 0!==r&&(o.row=r),v.errors.push(o)}this.parse=function(o,a,s){var c=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var n=new RegExp(h(t)+"([^]*?)"+h(t),"gm"),r=(e=e.replace(n,"")).split("\r"),o=e.split("\n"),a=1<o.length&&o[0].length<r[0].length;if(1===r.length||a)return"\n";for(var i=0,s=0;s<r.length;s++)"\n"===r[s][0]&&i++;return i>=r.length/2?"\r\n":"\r"}(o,c)),r=!1,e.delimiter)_(e.delimiter)&&(e.delimiter=e.delimiter(o),v.meta.delimiter=e.delimiter);else{var l=function(t,n,r,o,a){var s,c,l,u;a=a||[",","\t","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var d=0;d<a.length;d++){var f=a[d],p=0,h=0,y=0;l=void 0;for(var v=new m({comments:o,delimiter:f,newline:n,preview:10}).parse(t),g=0;g<v.data.length;g++)if(r&&b(v.data[g]))y++;else{var w=v.data[g].length;h+=w,void 0!==l?0<w&&(p+=Math.abs(w-l),l=w):l=w}0<v.data.length&&(h/=v.data.length-y),(void 0===c||p<=c)&&(void 0===u||u<h)&&1.99<h&&(c=p,s=f,u=h)}return{successful:!!(e.delimiter=s),bestDelimiter:s}}(o,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);l.successful?e.delimiter=l.bestDelimiter:(r=!0,e.delimiter=i.DefaultDelimiter),v.meta.delimiter=e.delimiter}var u=w(e);return e.preview&&e.header&&u.preview++,t=o,n=new m(u),v=n.parse(t,a,s),E(),f?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,n.abort(),t=_(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){l.streamer._halted?(f=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,n.abort(),v.meta.aborted=!0,_(e.complete)&&e.complete(v),t=""}}function h(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,n=(e=e||{}).delimiter,r=e.newline,o=e.comments,a=e.step,s=e.preview,c=e.fastMode,l=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(l=e.escapeChar),("string"!=typeof n||-1<i.BAD_DELIMITERS.indexOf(n))&&(n=","),o===n)throw new Error("Comment character same as delimiter");!0===o?o="#":("string"!=typeof o||-1<i.BAD_DELIMITERS.indexOf(o))&&(o=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var u=0,d=!1;this.parse=function(e,i,f){if("string"!=typeof e)throw new Error("Input must be a string");var p=e.length,m=n.length,y=r.length,v=o.length,g=_(a),w=[],b=[],E=[],k=u=0;if(!e)return $();if(c||!1!==c&&-1===e.indexOf(t)){for(var S=e.split(r),x=0;x<S.length;x++){if(E=S[x],u+=E.length,x!==S.length-1)u+=r.length;else if(f)return $();if(!o||E.substring(0,v)!==o){if(g){if(w=[],T(E.split(n)),F(),d)return $()}else T(E.split(n));if(s&&s<=x)return w=w.slice(0,s),$(!0)}}return $()}for(var j=e.indexOf(n,u),A=e.indexOf(r,u),I=new RegExp(h(l)+h(t),"g"),C=e.indexOf(t,u);;)if(e[u]!==t)if(o&&0===E.length&&e.substring(u,u+v)===o){if(-1===A)return $();u=A+y,A=e.indexOf(r,u),j=e.indexOf(n,u)}else{if(-1!==j&&(j<A||-1===A)){if(!(j<C)){E.push(e.substring(u,j)),u=j+m,j=e.indexOf(n,u);continue}var M=N(j,C,A);if(M&&void 0!==M.nextDelim){j=M.nextDelim,C=M.quoteSearch,E.push(e.substring(u,j)),u=j+m,j=e.indexOf(n,u);continue}}if(-1===A)break;if(E.push(e.substring(u,A)),z(A+y),g&&(F(),d))return $();if(s&&w.length>=s)return $(!0)}else for(C=u,u++;;){if(-1===(C=e.indexOf(t,C+1)))return f||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:w.length,index:u}),D();if(C===p-1)return D(e.substring(u,C).replace(I,t));if(t!==l||e[C+1]!==l){if(t===l||0===C||e[C-1]!==l){-1!==j&&j<C+1&&(j=e.indexOf(n,C+1)),-1!==A&&A<C+1&&(A=e.indexOf(r,C+1));var R=P(-1===A?j:Math.min(j,A));if(e[C+1+R]===n){E.push(e.substring(u,C).replace(I,t)),e[u=C+1+R+m]!==t&&(C=e.indexOf(t,u)),j=e.indexOf(n,u),A=e.indexOf(r,u);break}var O=P(A);if(e.substring(C+1+O,C+1+O+y)===r){if(E.push(e.substring(u,C).replace(I,t)),z(C+1+O+y),j=e.indexOf(n,u),C=e.indexOf(t,u),g&&(F(),d))return $();if(s&&w.length>=s)return $(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:w.length,index:u}),C++}}else C++}return D();function T(e){w.push(e),k=u}function P(t){var n=0;if(-1!==t){var r=e.substring(C+1,t);r&&""===r.trim()&&(n=r.length)}return n}function D(t){return f||(void 0===t&&(t=e.substring(u)),E.push(t),u=p,T(E),g&&F()),$()}function z(t){u=t,T(E),E=[],A=e.indexOf(r,u)}function $(e){return{data:w,errors:b,meta:{delimiter:n,linebreak:r,aborted:d,truncated:!!e,cursor:k+(i||0)}}}function F(){a($()),w=[],b=[]}function N(r,o,a){var i={nextDelim:void 0,quoteSearch:void 0},s=e.indexOf(t,o+1);if(o<r&&r<s&&(s<a||-1===a)){var c=e.indexOf(n,s);if(-1===c)return i;s<c&&(s=e.indexOf(t,s+1)),i=N(c,s,a)}else i={nextDelim:r,quoteSearch:o};return i}},this.abort=function(){d=!0},this.getCharIndex=function(){return u}}function y(e){var t=e.data,n=o[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var a={abort:function(){r=!0,v(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:g,resume:g};if(_(n.userStep)){for(var i=0;i<t.results.data.length&&(n.userStep({data:t.results.data[i],errors:t.results.errors,meta:t.results.meta},a),!r);i++);delete t.results}else _(n.userChunk)&&(n.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!r&&v(t.workerId,t.results)}function v(e,t){var n=o[e];_(n.userComplete)&&n.userComplete(t),n.terminate(),delete o[e]}function g(){throw new Error("Not implemented.")}function w(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=w(e[n]);return t}function b(e,t){return function(){e.apply(t,arguments)}}function _(e){return"function"==typeof e}return r&&(t.onmessage=function(e){var n=e.data;if(void 0===i.WORKER_ID&&n&&(i.WORKER_ID=n.workerId),"string"==typeof n.input)t.postMessage({workerId:i.WORKER_ID,results:i.parse(n.input,n.config),finished:!0});else if(t.File&&n.input instanceof File||n.input instanceof Object){var r=i.parse(n.input,n.config);r&&t.postMessage({workerId:i.WORKER_ID,results:r,finished:!0})}}),(l.prototype=Object.create(c.prototype)).constructor=l,(u.prototype=Object.create(c.prototype)).constructor=u,(d.prototype=Object.create(d.prototype)).constructor=d,(f.prototype=Object.create(c.prototype)).constructor=f,i}()}));const ce=e=>{try{return se.parse(e.replace(/^\ufeff/,""),{header:!0}).data}catch(e){return console.log(e),{}}};let le=null;const ue=async e=>{if(!le)try{const e=localStorage.getItem("sczh:data");if(!e)return!1;le=JSON.parse(e)}catch(e){return console.error(e),!1}if(K(C.version,le.version))return le=null,localStorage.removeItem("sczh:data"),!1;let t=e;/(\.csv|\.json)/.test(e)||(t=e+".csv");const{hashes:n}=await ae,r=n[t],o=le.hashes[t];return o&&o===r?le[e]:(le.hashes[t]=r,!1)},de=(e,t)=>{le&&le.hashes||(le={hashes:C.hashes,version:C.version});let n=e;/(\.csv|\.json)/.test(e)||(n=e+".csv");const r=C.hashes[n];r&&(le.hashes[n]=r),le[e]=t;const o=JSON.stringify(le);try{localStorage.setItem("sczh:data",o)}catch(e){console.error(e)}},fe=(e,t="EMPTY")=>e.sort((e,n)=>{let r=e,o=n;return"EMPTY"!==t&&(r=e[t],o=n[t]),o||(o=""),r||(r=""),o.length>r.length?1:r.length>o.length?-1:0}),pe=(e,t=[])=>{let n=e.replace(/\./g,"\\.").replace(/\$num/g,"([+-＋－]?[0-9０-９①-─]{1,10}\\.?[0-9０-９①-─]{0,4}?)").replace(/\$percent/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}?[%％])").replace(/\$unknown/g,"(.+?)").replace(/\$uk/g,"(.+?)").replace(/\$sep/g,".?");return t.forEach(e=>{n=n.replace(e.re,e.exp),e.re.lastIndex=0}),new RegExp(n,"gi")},he={expMap:new Map,nounMap:new Map,nounArr:[],loaded:!1},me=async()=>{const{expMap:e,nounMap:t,nounArr:n,loaded:r}=he;if(!r){let r=await ue("support-skill");r||(r=await ie("/data/support-skill.csv"),de("support-skill",r));const o=ce(r),a=new Map;fe(o,"text").forEach(e=>{if(null==e?void 0:e.text){const r=B(e.text),o=B(e.trans,!0),i=U(e.type);r&&o&&("noun"===i?(n.push(q(r)),t.set(r,o)):a.set(r,o))}});const i=[{re:/\$noun/g,exp:`(${n.join("|")})`}];for(let[t,n]of a){const r=pe(t,i);e.set(r,n)}he.loaded=!0}return{expMap:e,wordMaps:[t]}},ye={expMap:new Map,textMap:new Map,nounMap:new Map,nameMap:new Map,otherMap:new Map,nounArr:[],nameArr:[],otherArr:[],loaded:!1};var ve=function(){this.__data__=[],this.size=0};var ge=function(e,t){return e===t||e!=e&&t!=t};var we=function(e,t){for(var n=e.length;n--;)if(ge(e[n][0],t))return n;return-1},be=Array.prototype.splice;var _e=function(e){var t=this.__data__,n=we(t,e);return!(n<0)&&(n==t.length-1?t.pop():be.call(t,n,1),--this.size,!0)};var Ee=function(e){var t=this.__data__,n=we(t,e);return n<0?void 0:t[n][1]};var ke=function(e){return we(this.__data__,e)>-1};var Se=function(e,t){var n=this.__data__,r=we(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function xe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}xe.prototype.clear=ve,xe.prototype.delete=_e,xe.prototype.get=Ee,xe.prototype.has=ke,xe.prototype.set=Se;var je=xe;var Ae=function(){this.__data__=new je,this.size=0};var Ie=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Ce=function(e){return this.__data__.get(e)};var Me=function(e){return this.__data__.has(e)};var Re=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Oe=function(e){if(!Re(e))return!1;var t=y(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Te=i["__core-js_shared__"],Pe=function(){var e=/[^.]+$/.exec(Te&&Te.keys&&Te.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var De=function(e){return!!Pe&&Pe in e},ze=Function.prototype.toString;var $e=function(e){if(null!=e){try{return ze.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Fe=/^\[object .+?Constructor\]$/,Ne=Function.prototype,Le=Object.prototype,Ue=Ne.toString,Be=Le.hasOwnProperty,He=RegExp("^"+Ue.call(Be).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var qe=function(e){return!(!Re(e)||De(e))&&(Oe(e)?He:Fe).test($e(e))};var Je=function(e,t){return null==e?void 0:e[t]};var We=function(e,t){var n=Je(e,t);return qe(n)?n:void 0},Ge=We(i,"Map"),Ke=We(Object,"create");var Qe=function(){this.__data__=Ke?Ke(null):{},this.size=0};var Ve=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ye=Object.prototype.hasOwnProperty;var Xe=function(e){var t=this.__data__;if(Ke){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ye.call(t,e)?t[e]:void 0},Ze=Object.prototype.hasOwnProperty;var et=function(e){var t=this.__data__;return Ke?void 0!==t[e]:Ze.call(t,e)};var tt=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ke&&void 0===t?"__lodash_hash_undefined__":t,this};function nt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}nt.prototype.clear=Qe,nt.prototype.delete=Ve,nt.prototype.get=Xe,nt.prototype.has=et,nt.prototype.set=tt;var rt=nt;var ot=function(){this.size=0,this.__data__={hash:new rt,map:new(Ge||je),string:new rt}};var at=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var it=function(e,t){var n=e.__data__;return at(t)?n["string"==typeof t?"string":"hash"]:n.map};var st=function(e){var t=it(this,e).delete(e);return this.size-=t?1:0,t};var ct=function(e){return it(this,e).get(e)};var lt=function(e){return it(this,e).has(e)};var ut=function(e,t){var n=it(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function dt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}dt.prototype.clear=ot,dt.prototype.delete=st,dt.prototype.get=ct,dt.prototype.has=lt,dt.prototype.set=ut;var ft=dt;var pt=function(e,t){var n=this.__data__;if(n instanceof je){var r=n.__data__;if(!Ge||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ft(r)}return n.set(e,t),this.size=n.size,this};function ht(e){var t=this.__data__=new je(e);this.size=t.size}ht.prototype.clear=Ae,ht.prototype.delete=Ie,ht.prototype.get=Ce,ht.prototype.has=Me,ht.prototype.set=pt;var mt=ht;var yt=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},vt=function(){try{var e=We(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var gt=function(e,t,n){"__proto__"==t&&vt?vt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},wt=Object.prototype.hasOwnProperty;var bt=function(e,t,n){var r=e[t];wt.call(e,t)&&ge(r,n)&&(void 0!==n||t in e)||gt(e,t,n)};var _t=function(e,t,n,r){var o=!n;n||(n={});for(var a=-1,i=t.length;++a<i;){var s=t[a],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),o?gt(n,s,c):bt(n,s,c)}return n};var Et=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var kt=function(e){return g(e)&&"[object Arguments]"==y(e)},St=Object.prototype,xt=St.hasOwnProperty,jt=St.propertyIsEnumerable,At=kt(function(){return arguments}())?kt:function(e){return g(e)&&xt.call(e,"callee")&&!jt.call(e,"callee")};var It=function(){return!1},Ct=r((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?i.Buffer:void 0,a=(o?o.isBuffer:void 0)||It;e.exports=a})),Mt=/^(?:0|[1-9]\d*)$/;var Rt=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Mt.test(e))&&e>-1&&e%1==0&&e<t};var Ot=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Tt={};Tt["[object Float32Array]"]=Tt["[object Float64Array]"]=Tt["[object Int8Array]"]=Tt["[object Int16Array]"]=Tt["[object Int32Array]"]=Tt["[object Uint8Array]"]=Tt["[object Uint8ClampedArray]"]=Tt["[object Uint16Array]"]=Tt["[object Uint32Array]"]=!0,Tt["[object Arguments]"]=Tt["[object Array]"]=Tt["[object ArrayBuffer]"]=Tt["[object Boolean]"]=Tt["[object DataView]"]=Tt["[object Date]"]=Tt["[object Error]"]=Tt["[object Function]"]=Tt["[object Map]"]=Tt["[object Number]"]=Tt["[object Object]"]=Tt["[object RegExp]"]=Tt["[object Set]"]=Tt["[object String]"]=Tt["[object WeakMap]"]=!1;var Pt=function(e){return g(e)&&Ot(e.length)&&!!Tt[y(e)]};var Dt=function(e){return function(t){return e(t)}},zt=r((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,a=r&&r.exports===n&&o.process,i=function(){try{var e=r&&r.require&&r.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=i})),$t=zt&&zt.isTypedArray,Ft=$t?Dt($t):Pt,Nt=Object.prototype.hasOwnProperty;var Lt=function(e,t){var n=v(e),r=!n&&At(e),o=!n&&!r&&Ct(e),a=!n&&!r&&!o&&Ft(e),i=n||r||o||a,s=i?Et(e.length,String):[],c=s.length;for(var l in e)!t&&!Nt.call(e,l)||i&&("length"==l||o&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Rt(l,c))||s.push(l);return s},Ut=Object.prototype;var Bt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ut)},Ht=_(Object.keys,Object),qt=Object.prototype.hasOwnProperty;var Jt=function(e){if(!Bt(e))return Ht(e);var t=[];for(var n in Object(e))qt.call(e,n)&&"constructor"!=n&&t.push(n);return t};var Wt=function(e){return null!=e&&Ot(e.length)&&!Oe(e)};var Gt=function(e){return Wt(e)?Lt(e):Jt(e)};var Kt=function(e,t){return e&&_t(t,Gt(t),e)};var Qt=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Vt=Object.prototype.hasOwnProperty;var Yt=function(e){if(!Re(e))return Qt(e);var t=Bt(e),n=[];for(var r in e)("constructor"!=r||!t&&Vt.call(e,r))&&n.push(r);return n};var Xt=function(e){return Wt(e)?Lt(e,!0):Yt(e)};var Zt=function(e,t){return e&&_t(t,Xt(t),e)},en=r((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?i.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}}));var tn=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};var nn=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,a=[];++n<r;){var i=e[n];t(i,n,e)&&(a[o++]=i)}return a};var rn=function(){return[]},on=Object.prototype.propertyIsEnumerable,an=Object.getOwnPropertySymbols,sn=an?function(e){return null==e?[]:(e=Object(e),nn(an(e),(function(t){return on.call(e,t)})))}:rn;var cn=function(e,t){return _t(e,sn(e),t)};var ln=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e},un=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ln(t,sn(e)),e=E(e);return t}:rn;var dn=function(e,t){return _t(e,un(e),t)};var fn=function(e,t,n){var r=t(e);return v(e)?r:ln(r,n(e))};var pn=function(e){return fn(e,Gt,sn)};var hn=function(e){return fn(e,Xt,un)},mn=We(i,"DataView"),yn=We(i,"Promise"),vn=We(i,"Set"),gn=We(i,"WeakMap"),wn=$e(mn),bn=$e(Ge),_n=$e(yn),En=$e(vn),kn=$e(gn),Sn=y;(mn&&"[object DataView]"!=Sn(new mn(new ArrayBuffer(1)))||Ge&&"[object Map]"!=Sn(new Ge)||yn&&"[object Promise]"!=Sn(yn.resolve())||vn&&"[object Set]"!=Sn(new vn)||gn&&"[object WeakMap]"!=Sn(new gn))&&(Sn=function(e){var t=y(e),n="[object Object]"==t?e.constructor:void 0,r=n?$e(n):"";if(r)switch(r){case wn:return"[object DataView]";case bn:return"[object Map]";case _n:return"[object Promise]";case En:return"[object Set]";case kn:return"[object WeakMap]"}return t});var xn=Sn,jn=Object.prototype.hasOwnProperty;var An=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&jn.call(e,"index")&&(n.index=e.index,n.input=e.input),n},In=i.Uint8Array;var Cn=function(e){var t=new e.constructor(e.byteLength);return new In(t).set(new In(e)),t};var Mn=function(e,t){var n=t?Cn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},Rn=/\w*$/;var On=function(e){var t=new e.constructor(e.source,Rn.exec(e));return t.lastIndex=e.lastIndex,t},Tn=s?s.prototype:void 0,Pn=Tn?Tn.valueOf:void 0;var Dn=function(e){return Pn?Object(Pn.call(e)):{}};var zn=function(e,t){var n=t?Cn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var $n=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Cn(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return Mn(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return zn(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return On(e);case"[object Set]":return new r;case"[object Symbol]":return Dn(e)}},Fn=Object.create,Nn=function(){function e(){}return function(t){if(!Re(t))return{};if(Fn)return Fn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Ln=function(e){return"function"!=typeof e.constructor||Bt(e)?{}:Nn(E(e))};var Un=function(e){return g(e)&&"[object Map]"==xn(e)},Bn=zt&&zt.isMap,Hn=Bn?Dt(Bn):Un;var qn=function(e){return g(e)&&"[object Set]"==xn(e)},Jn=zt&&zt.isSet,Wn=Jn?Dt(Jn):qn,Gn={};Gn["[object Arguments]"]=Gn["[object Array]"]=Gn["[object ArrayBuffer]"]=Gn["[object DataView]"]=Gn["[object Boolean]"]=Gn["[object Date]"]=Gn["[object Float32Array]"]=Gn["[object Float64Array]"]=Gn["[object Int8Array]"]=Gn["[object Int16Array]"]=Gn["[object Int32Array]"]=Gn["[object Map]"]=Gn["[object Number]"]=Gn["[object Object]"]=Gn["[object RegExp]"]=Gn["[object Set]"]=Gn["[object String]"]=Gn["[object Symbol]"]=Gn["[object Uint8Array]"]=Gn["[object Uint8ClampedArray]"]=Gn["[object Uint16Array]"]=Gn["[object Uint32Array]"]=!0,Gn["[object Error]"]=Gn["[object Function]"]=Gn["[object WeakMap]"]=!1;var Kn=function e(t,n,r,o,a,i){var s,c=1&n,l=2&n,u=4&n;if(r&&(s=a?r(t,o,a,i):r(t)),void 0!==s)return s;if(!Re(t))return t;var d=v(t);if(d){if(s=An(t),!c)return tn(t,s)}else{var f=xn(t),p="[object Function]"==f||"[object GeneratorFunction]"==f;if(Ct(t))return en(t,c);if("[object Object]"==f||"[object Arguments]"==f||p&&!a){if(s=l||p?{}:Ln(t),!c)return l?dn(t,Zt(s,t)):cn(t,Kt(s,t))}else{if(!Gn[f])return a?t:{};s=$n(t,f,c)}}i||(i=new mt);var h=i.get(t);if(h)return h;i.set(t,s),Wn(t)?t.forEach((function(o){s.add(e(o,n,r,o,t,i))})):Hn(t)&&t.forEach((function(o,a){s.set(a,e(o,n,r,a,t,i))}));var m=u?l?hn:pn:l?keysIn:Gt,y=d?void 0:m(t);return yt(y||t,(function(o,a){y&&(o=t[a=o]),bt(s,a,e(o,n,r,a,t,i))})),s};var Qn=function(e){return Kn(e,5)};let Vn=null;const Yn=new Map([["AOBA",e=>e&&e.loaders&&e.Text&&e.BLEND_MODES],["SCENARIO",e=>e&&e.default&&e.default.load&&e.default._errorEvent&&e.default._handleError],["REQUEST",e=>e&&e.get&&e.post&&e.put&&e.patch],["PHRASE",e=>e&&e.default&&e.default._polyglot&&e.default._polyglot.phrases],["SPEAKER",e=>e&&e.default&&e.default.getCharacterBackLogIconId]]),Xn=new Map([["AOBA",e=>e],["SCENARIO",e=>e.default],["REQUEST",e=>e],["PHRASE",e=>e.default._polyglot.phrases],["SPEAKER",e=>e.default]]),Zn=Object.freeze;Object.freeze=new Proxy(Zn,{apply:(e,t,[n])=>n});const er=Function.prototype.call;let tr={Reflect:window.Reflect};Function.prototype.call=new Proxy(er,{apply(e,t,n){var r;return(null==n||null===(r=n[3])||void 0===r?void 0:r.toString)&&"function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}"===n[3].toString()&&(Vn=n[3],Function.prototype.call=er),tr.Reflect.apply(e,t,n)}});const nr=async e=>{const{moduleId:t}=await ae,n=((e,t)=>{let n,r=((e,t)=>{let n=e+t,r=[];for(let o=e-t;o<=n;o++)o>=0&&o!==e&&r.push(o);return r.unshift(e),r})(e,10);for(let e=0;e<r.length;e++){let o=Vn(r[e]);if(t(o)){n=o;break}}return n})(t[e],Yn.get(e));return n?Xn.get(e)(n):null},rr=(e,t,n,r)=>{if(C.dev){let o=r;r&&(o=Qn(r)),J(`%c${e}%c %c${n[0]}`,...(e=>[`background-color:${e};color:#fff;padding:0 0.3em`,"",`color:${e};text-decoration:underline`])(t),n[1]||"","\n=>",o)}},or=async(e,t,n)=>{try{for(let[r,o]of n){let n=!1;if(("string"===o.type&&o.key===t||"regexp"===o.type&&o.key.test(t))&&(n=!0),n){const t=o.handles;for(let n of t)await n(e)}}}catch(e){J(e)}},ar=e=>{const t=e.replace(/{num}/g,"\\d+").replace(/{uuid}/g,"[a-f\\d]{8}-([a-f\\d]{4}-){3}[a-f\\d]{12}");return new RegExp(`^${t}$`)},ir={get:new Map,post:new Map,patch:new Map,put:new Map},sr=(e,t,n)=>{if(!n.has(e)){const t=e.includes("{")||e.includes("("),r={handles:[],key:t?ar(e):e,type:t?"regexp":"string"};n.set(e,r)}const r=n.get(e);Array.isArray(t)?r.handles=r.handles.concat(t):r.handles.push(t)},cr=(e,t,n)=>{if(Array.isArray(e))for(let r of e)sr(r,t,n);else sr(e,t,n)},lr=e=>(t,n)=>{const r=ir[e];if(n)cr(t,n,r);else{const e=t;for(let[t,n]of e)cr(t,n,r)}},ur={get:lr("get"),post:lr("post"),patch:lr("patch"),put:lr("put")};async function dr(){const e=await nr("REQUEST"),t=e.get;e.get=async function(...e){const n=e[0],r=await t.apply(this,e);if(!n)return r;let o=r.body;return rr("GET","#009688",e,o),await or(o,n,ir.get),r};const n=e.patch;e.patch=async function(...e){const t=e[0],r=await n.apply(this,e);if(!t)return r;let o=r.body;return rr("PATCH","#8BC34A",e,o),await or(o,t,ir.patch),r};const r=e.post;e.post=async function(...e){const t=e[0],n=await r.apply(this,e);if(!t)return n;let o=n.body;return rr("POST","#3F51B5",e,o),await or(o,t,ir.post),n};const o=e.put;e.put=async function(...e){const t=e[0],n=await o.apply(this,e);if(!t)return n;let r=n.body;return rr("PUT","#9C27B0",e,r),await or(r,t,ir.put),n}}let fr=null,pr=null;const hr=async()=>{fr||(fr=(async()=>{const{expMap:e,nounMap:t,textMap:n,nameMap:r,otherMap:o,nounArr:a,nameArr:i,otherArr:s,loaded:c}=ye;if(!c){let c=await ue("skill");c||(c=await ie("/data/skill.csv"),de("skill",c));const l=ce(c),u=new Map;fe(l,"text").forEach(e=>{if(null==e?void 0:e.text){const c=B(e.text),l=B(e.trans,!0),d=U(e.type);c&&l&&("noun"===d?(a.push(q(c)),t.set(c,l)):"text"===d?n.set(c,l):"name"===d?(i.push(q(c)),r.set(c,l)):"other"===d?(s.push(q(c)),o.set(c,l)):u.set(c.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),l))}});const d=[{re:/\$noun/g,exp:`(${a.join("|")})`},{re:/\$name/g,exp:`(${i.join("|")})`},{re:/\$other/g,exp:`(${s.join("|")})`}];for(let[t,n]of u){const r=pe(t,d);e.set(r,n)}ye.loaded=!0}return{expMap:e,wordMaps:[t,o,r],textMap:n}})()),pr||(pr=await fr)},mr=(e,t)=>{if(!t){let t=[];return e.forEach((n,r)=>{let o=n.match(/([＋+]+)$/);(null==o?void 0:o[1])?(t.push(o[1]),e[r]=n.replace(/[＋+]+$/,"")):t.push("")}),t}e.forEach((n,r)=>{e[r]=n+t[r]})},yr=(t,n,r=pr)=>{if(null==t?void 0:t[n]){let o=t[n].split("/");o.forEach((e,t)=>{let n=mr(o);ee(o,t,r),mr(o,n)});let a=o.join("/");a!==t[n]&&(t[n]=e(a))}},vr=(e,t)=>{null==e||e.forEach(e=>{yr(e,"description",t),yr(e,"name",t)})},gr=async e=>{var t,n;const r=await me(),o=null!==(t=e.userSupportIdol)&&void 0!==t?t:e;vr(o.acquiredSupportSkills,r),vr(o.supportSkills,r),vr(null===(n=o.supportIdol)||void 0===n?void 0:n.supportSkills,r)},wr=e=>{var t,n;null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{yr(e,"effectName"),yr(e,"effectDescription")}),null===(n=e.rivalMemoryAppealEffects)||void 0===n||n.forEach(e=>{yr(e,"effectName"),yr(e,"effectDescription")})},br=(e,t=!1)=>{e&&(yr(e,"comment"),yr(e,"name"),t&&wr(e),e.linkSkill&&(yr(e.linkSkill,"comment"),yr(e.linkSkill,"name"),t&&wr(e.linkSkill)))},_r=e=>{yr(e,"name"),yr(e,"description")},Er=e=>{e&&e.forEach(e=>{yr(e,"releaseConditions"),yr(e.passiveSkills,"comment"),yr(e.passiveSkills,"name"),br(e.skill),br(e.concertActiveSkill),e.activeSkills&&e.activeSkills.forEach(e=>{br(e)})})},kr=e=>{e.forEach(e=>{br(e)})},Sr=(e,t=!1)=>{var n,r,o,a;let i=e.userProduceIdol;i&&(null===(n=i.activeSkills)||void 0===n||n.forEach(e=>{br(e)}),null===(r=i.abilities)||void 0===r||r.forEach(e=>{br(e)}),null===(o=i.passiveSkills)||void 0===o||o.forEach(e=>{br(e)}),null===(a=i.limitBreaks)||void 0===a||a.forEach(e=>{br(e)}),t&&Er(i.skillPanels))},xr=e=>{e.forEach(e=>{br(e.skill,!0)})},jr=e=>{e&&e.forEach(e=>{var t,n,r;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{wr(e)})}),null===(n=e.userRaidDeck)||void 0===n||n.userRaidDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{br(e,!0)})}),null===(r=e.rival)||void 0===r||r.rivalSkills.forEach(e=>{wr(e)})})},Ar=async e=>{await hr(),Er(e.idol.skillPanels),kr(e.idol.memoryAppeals),e.userIdolProduceExSkills.forEach(e=>{_r(e.produceExSkill)})},Ir=async e=>{var t,n,r,o;await hr(),Er(e.supportIdol.skillPanels),null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{_r(e.produceExSkill)}),null===(n=e.supportIdol)||void 0===n||null===(r=n.supportIdolActiveSkill)||void 0===r||null===(o=r.activeSkills)||void 0===o||o.forEach(e=>{yr(e,"comment"),yr(e,"name")})},Cr=async e=>{await hr();const t=e.userFesIdol;t.activeSkills.forEach(e=>{br(e)}),t.abilities.forEach(e=>{br(e)}),br(t.memoryAppeal),t.passiveSkills.forEach(e=>{yr(e,"comment"),yr(e,"name")}),t.userFesIdolProduceExSkills.forEach(e=>{_r(e.produceExSkill)}),t.userFesSupportIdols.forEach(e=>{e.userFesSupportIdolProduceExSkills.forEach(e=>{_r(e.produceExSkill)})})},Mr=Cr,Rr=async e=>{await hr(),e.userProduceExSkills.forEach(e=>{_r(e.produceExSkill)})},Or=async e=>{var t,n,r,o;await hr(),e.userProduceSupportIdols.forEach(e=>{Er(e.skillPanels)}),Sr(e,!0),null===(t=e.userProduceLimitedSkills)||void 0===t||t.forEach(e=>{br(e.passiveSkills),br(e.skill)}),Er(null===(n=e.userProduceIdol)||void 0===n||null===(r=n.userIdol)||void 0===r||null===(o=r.idol)||void 0===o?void 0:o.skillPanels)},Tr=async e=>{var t,n;await hr();const r=e=>{e.userFesIdol.activeSkills.forEach(e=>{br(e,!0)}),e.userFesIdol.abilities.forEach(e=>{br(e)}),e.userFesIdol.concertAbilities.forEach(e=>{br(e)}),br(e.userFesIdol.memoryAppeal,!0),e.userFesIdol.passiveSkills.forEach(e=>{yr(e,"comment"),yr(e,"name"),wr(e)})};null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(r),null===(n=e.userRaidDeck)||void 0===n||n.userRaidDeckMembers.forEach(r),xr(e.judges),jr(e.userFesRivals),jr(e.userFesRaidRivals)},Pr=async e=>{var t,n,r;await hr(),null===(t=e.fanActiveSkills)||void 0===t||t.forEach(e=>{br(e,!0)}),e.userProduceSupportIdols.forEach(e=>{br(e.activeSkill,!0)});let o=e.userProduceIdol;o.activeSkills.forEach(e=>{br(e,!0)}),null===(n=o.abilities)||void 0===n||n.forEach(e=>{br(e,!0)}),null===(r=o.concertAbilities)||void 0===r||r.forEach(e=>{br(e,!0)}),br(o.memoryAppeal,!0),o.passiveSkills.forEach(e=>{br(e,!0)});let a=e.produceAudition||e.produceConcert;xr(a.judges),(e=>{e.forEach(e=>{wr(e.rivalMemoryAppeal),e.rivalSkills.forEach(e=>{wr(e)})})})(a.rivals)},Dr=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?await Pr(t):(t.userFesDeck||t.userRaidDeck)&&await Tr(t),e.gameData=JSON.stringify(t)}catch(e){J(e)}},zr=async e=>{await hr(),e.userProduceIdol.activeSkills.forEach(e=>{br(e)}),e.userProduceIdol.abilities.forEach(e=>{br(e)}),e.userProduceAbilities.forEach(e=>{br(e.ability),yr(e.ability,"acquireComment"),e.ability.produceAbilityAcquireConditionComments.forEach(e=>{yr(e,"name")})})};ur.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[gr,Ir]],["userProduce(Teaching)?SupportIdols/{num}",[gr,async e=>{var t,n,r,o,a;await hr(),Er(e.skillPanels),null===(t=e.userProduceSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{_r(e.produceExSkill)}),null===(n=e.userSupportIdol)||void 0===n||null===(r=n.supportIdol)||void 0===r||null===(o=r.supportIdolActiveSkill)||void 0===o||null===(a=o.activeSkills)||void 0===a||a.forEach(e=>{yr(e,"comment"),yr(e,"name")})}]],["userReserveSupportIdols/userSupportIdol/{num}",[gr,async e=>{var t,n,r;await hr(),Er(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(n=t.supportIdolActiveSkill)||void 0===n||null===(r=n.activeSkills)||void 0===r||r.forEach(e=>{yr(e,"comment"),yr(e,"name")})}]],["userIdols/{num}/produceExSkillTop",Rr],["userSupportIdols/{num}/produceExSkillTop",Rr],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[Ar]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],async e=>{await hr(),e.activeSkills.forEach(e=>{br(e)}),kr(e.userIdol.idol.memoryAppeals),e.userProduceIdolProduceExSkills.forEach(e=>{_r(e.produceExSkill)})}],["userReserveIdols/userIdol/{num}",async e=>{await hr(),Er(e.idol.skillPanels),kr(e.idol.memoryAppeals)}],["userFesIdols/{num}",Cr],[["userProduces/skillPanels","userProduceTeachings/skillPanels"],Or],["fes(Match)?Concert/actions/resume",[Dr]],["earthUsers/{uuid}/userFesIdols/{num}",Mr],["userRaidDecks",async e=>{await hr(),e.userRaidDecks.forEach(e=>{e.userRaidDeckMembers.forEach(e=>{var t;null===(t=e.userFesIdol)||void 0===t||t.activeSkills.forEach(e=>{br(e)})})})}],["produces/{num}/decks",async e=>{var t;const n=await me();null===(t=e.userSupportIdols)||void 0===t||t.forEach(e=>{var t;vr(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills,n)})}],["userProduceAbilities",zr],["userProduceAreas",async e=>{var t;await hr(),null===(t=e.abilities)||void 0===t||t.forEach(e=>{yr(e,"acquireComment"),yr(e,"name"),yr(e,"comment")})}]]),ur.post([["userIdols/{num}/produceExSkills/{num}/actions/set",Ar],["produces/{num}/actions/ready",[async e=>{const t=await me();e.userDecks.forEach(e=>{e.userSupportIdols.forEach(e=>{var n;vr(null===(n=e.supportIdol)||void 0===n?void 0:n.supportSkills,t)})})}]],[["userProduce(Teaching)?s/skillPanels/{num}","userProduces/limitedSkills/{num}"],Or],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Ir,gr]],["produces/actions/(resume|next)",[async e=>{e.userProduceIdeaNotes&&(await hr(),e.userProduceIdeaNotes.forEach(e=>{let t=e.produceIdeaNote.produceIdeaNoteCompleteBonus;yr(t,"title"),yr(t,"comment"),e.produceIdeaNote.produceIdeaNoteExtraBonuses.forEach(e=>{yr(e,"comment"),yr(e,"condition")})}))},gr]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[async e=>{e.gameData||(await hr(),Sr(e))},Dr]],["produces/actions/act",[async e=>{var t,n,r;await hr();let o=null===(t=e.lessonResult)||void 0===t||null===(n=t.userProduceIdeaNote)||void 0===n||null===(r=n.produceIdeaNote)||void 0===r?void 0:r.produceIdeaNoteCompleteBonus;br(o)}]],["fes(Match|Raid)?Concert/actions/start",[Tr]],["fes(Match)?Concert/actions/resume",[Dr]],["fesRaidConcert/actions/resume",[async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userRaidDeck&&await Tr(t),e.gameState.game_data=JSON.stringify(t)}catch(e){J(e)}}]],["produces/actions/result",[async e=>{await hr(),e.produceExSkillRewards.forEach(e=>{_r(e.produceExSkill)})}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[Pr]],["produces/({num}/audition|concert)/actions/(start|finish)",async e=>{var t,n;await hr(),null===(t=e.concertEvent)||void 0===t||null===(n=t.abilities)||void 0===n||n.forEach(e=>{yr(e,"name")})}],[["produceTeachings/resume","produceTeachings/next"],gr],["userProduceAbilities",zr]]),ur.patch("userSupportIdols/{num}",gr);const $r=new Map,Fr=new Map,Nr=new Map;let Lr=!1;const Ur=async()=>{if(!Lr){let e=await ue("item");e||(e=await ie("/data/item.csv"),de("item",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=B(e.text),n=B(e.trans,!0),r=U(e.type)||"normal";t&&n&&t!==n&&("limit"===r?Fr.set(t,n):"note"===r?Nr.set(t,n):$r.set(t,n))}}),Lr=!0}return{itemMap:$r,itemLimitMap:Fr,itemNoteMap:Nr}};let Br=new Map,Hr=new Map,qr=new Map,Jr=new Map,Wr=new Map,Gr=!1;const Kr=["produceItem","recoveryItem","exchangeItem","lotteryTicket","evolutionItem","gashaTicket","scoutTicket","enhancementItem"];let Qr,Vr;const Yr=async()=>{Vr||(Vr=Ur()),Qr||(Qr=await Vr)};let Xr=[];(window.unsafeWindow||window).printUnknowItems=()=>J(Xr.join("\n"));const Zr=(t,n)=>{if(!t||"string"!=typeof t[n])return;const{itemMap:r,itemLimitMap:o,itemNoteMap:a}=Qr;let i=H(t[n]),s="",c="",l="";if(/[\s\S]+[\r\n]{0,2}\[[^\]]+\]$/.test(i)){let e=i.match(/([\s\S]+)([\r\n]{0,2}\[[^\]]+\])$/);i=e[1].trim();let t=e[2];s=o.has(t)?o.get(t):t}if(/[\s\S]+[\r\n]{0,2}【Exp:\d+】$/.test(i)){let e=i.match(/([\s\S]+)([\r\n]{0,2}【Exp:\d+】)$/);i=e[1].trim(),l=e[2]}if(/[\s\S]+[\r\n]{0,2}[(（][^)）]+[）)]$/.test(i)){let e=i.match(/([\s\S]+)([\r\n]{0,2})[(（]([^)）]+)[）)]$/);i=e[1].trim();let t=e[3];c=a.has(t)?`${e[2]}（${a.get(t)}）`:e[2]+"（txt）"}if(r.has(i)){let o=r.get(i);o=`${o}${c}${l}${s}`,t[n]=e(o)}else C.dev&&(e=>{if(!e)return;let t=G(e);Xr.includes(t)||Xr.push(t)})(t[n])},eo=e=>{var t;null==e||null===(t=e.shopMerchandises)||void 0===t||t.forEach(e=>{Zr(e,"title"),Zr(e,"shopTitle"),Zr(e,"comment")})},to=async e=>{let t=e;e.userProduceItems&&(t=e.userProduceItems),await Yr(),Array.isArray(t)&&t.forEach(e=>{const t=e[Kr[0]]||e[Kr[1]]||e[Kr[2]]||e[Kr[3]]||e[Kr[4]]||e[Kr[5]]||e[Kr[6]]||e[Kr[7]];Zr(t,"name"),Zr(t,"comment")})},no=async e=>{await Yr(),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{e.gameEventAccumulatedPresent.rewards.forEach(e=>{Zr(e.content,"name")})})},ro=async e=>{var t;await Yr(),null==e||null===(t=e.activeProduceItems)||void 0===t||t.forEach(e=>{Zr(e.produceItem,"name"),Zr(e.produceItem,"comment")})};ur.get([[["userShops","userIdolPieceShops"],async e=>{await Yr(),e&&(Array.isArray(e.userShops)&&e.userShops.forEach(e=>{eo(e)}),Array.isArray(e.userEventShops)&&e.userEventShops.forEach(e=>{eo(e.userShop)}))}],[["userRecoveryItems","userProduceItems","userExchangeItems","userLotteryTickets","userEvolutionItems","userGashaTickets","userScoutTickets","userEnhancementItems"],to],[["userPresents\\?limit={num}","userPresentHistories\\?limit={num}"],async e=>{await Yr(),Array.isArray(e)&&e.forEach(e=>{Zr(e.content,"name"),Zr(e,"note")})}],["userProduces",ro],["missionEvents/{num}/top",no]]),ur.post([["myPage",async e=>{await ro(e.userProduce)}],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",no],["userShops/actions/purchase",async e=>{await Yr(),Zr(null==e?void 0:e.shopMerchandise,"title"),Zr(null==e?void 0:e.shopMerchandise,"comment")}],["produces/{num}/actions/ready",to],["userPresents/{num}/actions/receive",async e=>{await Yr(),Zr(e.receivedPresent,"Name")}],["userMissions/{num}/actions/receive",async e=>{await Yr(),Zr(e.userMission.mission.missionReward.content,"name")}],["userLoginBonuses",async e=>{await Yr(),e.userLoginBonuses.forEach(e=>{e.loginBonus.sheets.forEach(e=>{e.rewards.forEach(e=>{Zr(e.content,"name")})})}),e.userTotalBonuses.forEach(e=>{e.rewards.forEach(e=>{Zr(e.content,"name")})})}],["fesTop",async e=>{await Yr(),e.lastRankingResult&&Array.isArray(e.lastRankingResult.fesMatchGradeRewards)&&e.lastRankingResult.fesMatchGradeRewards.forEach(e=>{Zr(e.content,"name")})}],["userSelectLoginBonuses/{num}",async e=>{await Yr(),e.rewards.forEach(e=>{Zr(e.content,"name")})}]]),ur.patch("produces/{num}/produceItem/consume",async e=>{var t;await Yr();const n=null===(t=e.consumeProduceItem)||void 0===t?void 0:t.produceItem;n&&(Zr(n,"name"),Zr(n,"comment"))});let oo=null,ao=null;const io=async()=>{ao||(ao=(async(e=!1)=>{if(!Gr){let e=await ue("mission-re");e||(e=await ie("/data/mission-re.csv"),de("mission-re",e));const t=ce(e),n=[],r=[],o=[],a=new Map;fe(t,"text").forEach(e=>{if(null==e?void 0:e.text){const t=B(e.text),i=B(e.trans,!0),s=U(e.type);t&&i&&("noun"===s?(n.push(q(t)),qr.set(t,i)):"note"===s?(o.push(q(t)),Wr.set(t,i),a.set(`【${t}】`,`【${i}】`)):"name"===s?(r.push(q(t)),Jr.set(t,i)):"exp"===s&&a.set(t,i),"exp"!==s&&Br.set(t,i))}});const i=[{re:/\$name/g,exp:`(${r.join("|")})`},{re:/\$noun/g,exp:`(${n.join("|")})`},{re:/\$note/g,exp:`(${o.join("|")})`}];for(let[e,t]of a){const n=pe(e,i);Hr.set(n,t)}Gr=!0}const t=[qr,Wr,Jr];let{itemMap:n}=await Ur();return Br=new Map([...n,...Br]),{expMap:Hr,wordMaps:t,textMap:Br}})()),await Yr(),oo=await ao},so=(t,n)=>{let r=!1;if(!t||"string"!=typeof t[n])return r;const{expMap:o,wordMaps:a,textMap:i}=oo,s=H(t[n]);let c=s;return s?(i.has(s)?(r=!0,t[n]=e(i.get(s))):(c=Z(s,o,a),s!==c?(r=!0,t[n]=e(c)):C.dev&&ho(t,n)),r):r},co=(e,t)=>{so(e,t)||Zr(e,t)},lo=e=>{null==e||e.forEach(e=>{so(e.mission,"title"),so(e.mission,"comment"),e.mission.missionReward.content&&(co(e.mission.missionReward.content,"name"),co(e.mission.missionReward.content,"comment"))})},uo=e=>{e.forEach(e=>{let t=e.fesRaidAccumulatedReward;so(t,"title"),so(t,"comment");let n=t.fesRaidAccumulatedRewardContent;(null==n?void 0:n.content)&&(co(n.content,"name"),co(n.content,"comment"))})},fo=(e,t=!0)=>{null==e||e.forEach(e=>{let n=e.mission||e;if(so(n,"title"),so(n,"comment"),so(n,"afterAchievedComment"),so(n,"beforeAchievedComment"),t){let e=n.lectureMissionReward;(null==e?void 0:e.content)&&(co(e.content,"name"),co(e.content,"comment"))}})},po=[],ho=(e,t)=>{if(!e[t])return;const n=G(e[t]);po.includes(n)||po.push(n)};(window.unsafeWindow||window).printUnknownMission=()=>J(po.join("\n"));const mo=async e=>{var t,n;await io(),so(null===(t=e.userRecommendedMission)||void 0===t?void 0:t.mission,"comment"),so(null===(n=e.userRecommendedMission)||void 0===n?void 0:n.mission,"title"),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{so(e.gameEventAccumulatedPresent,"comment"),so(e.gameEventAccumulatedPresent,"title")})},yo=async e=>{var t;await io(),null===(t=e.teachingHints)||void 0===t||t.forEach(e=>{var t,n;null===(t=e.userProduceHints)||void 0===t||t.forEach(e=>{so(e.produceTeachingHint,"title")}),null===(n=e.userProduceTeachingHints)||void 0===n||n.forEach(e=>{so(e.produceTeachingHint,"title")})})},vo=async e=>{await io(),fo(e.lectureMissions)},go=e=>{var t;null===(t=e.userIdolRoad)||void 0===t||t.idolRoad.idolRoadRewards.forEach(e=>{co(e.content,"name"),co(e.content,"comment")})};ur.get([["userMissions",async e=>{var t;await io(),lo(e.dailyUserMissions),lo(e.weeklyUserMissions),null===(t=e.eventUserMissions)||void 0===t||t.forEach(e=>{lo(null==e?void 0:e.userMissions)}),lo(e.normalUserMissions),lo(e.specialUserMissions)}],["fesRaidEvents/{num}/rewards",async e=>{await io(),uo(e.fesRaidBestScoreRewards),uo(e.fesRaidLapRewards),uo(e.fesRaidPointRewards)}],["userProduces",[yo]],["userBeginnerMissions/top",vo],["idolRoads/top",async e=>{var t;await io(),fo(e.userMissions,!1),null===(t=e.userIdols)||void 0===t||t.forEach(go)}],["missionEvents/{num}/top",[mo]]]),ur.post([["myPage",[async e=>{await io(),lo(e.reportUserMissions)},async e=>{await io();let t=e.beginnerMission;t&&(t.clearedLectureMission&&fo([t.clearedLectureMission]),t.progressLectureMission&&fo([t.progressLectureMission]))}]],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",[mo]],[["produceTeachings/resume","produceTeachings/next"],yo],["userLectureMissions/{num}/actions/receive",vo]]),ur.put("userIdolRoads",async e=>{await io(),go(e.userIdol)});const wo=new Map;let bo=!1;const _o=async()=>{if(!bo){let e=await ue("name");e||(e=await ie("/data/name.csv"),de("name",e));ce(e).forEach(e=>{const t=U(e.name),n=U(e.trans);t&&n&&t!==n&&wo.set(t,n)}),bo=!0}return wo},Eo=new Map,ko=new Map,So=new Map;let xo=!1;let jo,Ao,Io,Co;const Mo=async()=>{Io||(Io=(async()=>{if(!xo){let e=await ue("title");e||(e=await ie("/data/title.csv"),de("title",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=B(e.text),n=B(e.trans,!0),r=U(e.type)||"text";t&&n&&t!==n&&("exp"===r?ko.set(t,n):"text"===r&&Eo.set(t,n))}});for(let[e,t]of ko){const n=pe(e);So.set(n,t)}xo=!0}return{textMap:Eo,expMap:So}})(),Co=_o()),jo&&Ao||(jo=await Io,Ao=await Co,jo.wordMaps=[Ao])};let Ro=[];(window.unsafeWindow||window).printUnknowTitles=()=>J(Ro.join("\n"));const Oo=new Map,To=(e,t)=>{e&&w(t)&&(Oo.has(e)||Oo.set(e,t))},Po=(e={},t)=>{let n=e[t];ee(e,t,jo),C.dev&&n===e[t]&&(e=>{if(!e)return;let t=G(e);Ro.includes(t)||Ro.push(t)})(n)},Do=e=>{e.forEach(e=>{Po(e,"name"),e.communications.forEach(e=>{Po(e,"name"),Po(e,"title"),To(e.id,`${e.name}-${e.title}`)})})};ur.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],async e=>{await Mo(),e.supportIdol.produceSupportIdolEvents.forEach(e=>{Po(e,"title"),To(e.id,e.title)})}],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],async e=>{await Mo(),e.idol.produceAfterEvents.forEach(e=>{Po(e,"title"),To(e.id,e.title)}),e.idol.produceIdolEvents.forEach(e=>{Po(e,"title"),To(e.id,e.title)})}],[["characterAlbums","album/top"],async e=>{await Mo(),Do(e.gameEvents),Do(e.specialEvents)}]]),ur.post([["characterAlbums/characters/{num}",async e=>{await Mo(),e.albumCommunicationTitles.forEach(e=>{Po(e,"title")}),e.communications.forEach(e=>{Po(e,"title"),To(e.communicationId,e.title)}),e.voices.forEach(e=>{Po(e,"title"),Po(e,"releasedConditionComment")})}],["produceMarathons/{num}/top",async e=>{await Mo(),e.releasedCommunications.forEach(e=>{Po(e,"name"),Po(e,"title"),To(e.id,`${e.name}-${e.title}`)}),Po(e.gameEvent,"name")}]]);const zo=async t=>{const n=await _o();if(t.userProduceIdol){const r=t.userProduceIdol.userIdol.idol.character;n.has(r.name)&&(r.name=e(n.get(r.name))),n.has(r.firstName)&&(r.firstName=e(n.get(r.firstName)))}},$o=async e=>{var t;await Mo(),null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{Po(e,"title"),To(e.id,e.title)})};ur.post([["myPage",async e=>{var t;await Mo(),Po(null==e||null===(t=e.userProduce)||void 0===t?void 0:t.produce,"title")}],["produces/actions/(resume|next)",[$o,zo]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],$o],["produces/actions/act",$o],["produces/({num}/audition|concert)/actions/(start|finish)",zo]]);const Fo=new Map;let No=!1;const Lo=async()=>{if(!No){let e=await ue("noun-fix");e||(e=await ie("/data/etc/noun-fix.csv"),de("noun-fix",e));const t=ce(e);fe(t,"text").forEach(e=>{const t=U(e.text),n=U(e.fixed);t&&Fo.set(t,n)}),No=!0}return Fo},Uo=new Map;let Bo=!1;const Ho=new Map,qo=new Map;let Jo=!1,Wo=null;const Go=t=>{const n=ce(t),r=new Map,o=V();return n.forEach(t=>{const n=o(U(t.id)),a=B(t.text),i=B(t.trans,!0),s=U(t.name);a&&i&&(n&&!/^0+$/.test(n)&&"select"!==n?r.set(n,e(i)):"select"===n?r.set(a+"-select",e(i)):r.set(a,e(i))),n&&s&&"info"===n&&r.set("name",s)}),r},Ko=async()=>{if(!Jo){let e=await ue("comm-story");e||(e=await ie("/data/comm-story.csv"),de("comm-story",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=B(e.text),n=B(e.trans,!0);t&&n&&t!==n&&qo.set(t,n)}}),Jo=!0}return qo};let Qo=new Map,Vo=!1;const Yo=async()=>{if(!Vo){let e=await ue("type-text");e||(e=await ie("/data/type-text.csv"),de("type-text",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=B(e.text),n=B(e.trans,!0);t&&n&&t!==n&&Qo.set(t,n)}});const t=await Ko(),n=await _o();Qo=new Map([...t,...Qo,...n]),Vo=!0}return Qo},Xo=!!window.GM_xmlhttpRequest,Zo=(e,t={})=>{const{method:n="GET",headers:r,responseType:o="json",data:a,cors:i=!1,credentials:s}=t;return i?fetch(e,{body:a,headers:r,method:n,mode:"cors",credentials:s}).then(e=>e.json()):new Promise((t,i)=>{if(!Xo)return i("GM_XHR MISSING");window.GM_xmlhttpRequest({method:n,url:e,headers:r,responseType:o,data:a,onload({status:e,responseText:n,statusText:r}){if(e>=200&&e<300)if("json"===o){const e=JSON.parse(n);t(e)}else t(n);else i(r)},onerror(e){i(e)}})})};var ea=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},ta=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},na=function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},ra=function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},oa=function(e,t){return[e[0]^t[0],e[1]^t[1]]},aa=function(e){return e=oa(e,[0,e[0]>>>1]),e=ta(e,[4283543511,3981806797]),e=oa(e,[0,e[0]>>>1]),e=ta(e,[3301882366,444984403]),e=oa(e,[0,e[0]>>>1])};let ia="",sa="",ca=!1;const la=()=>{let e="0123456789abcdefghijklmnopqrstuvwxyz",t="";for(let n=0;n<33;n++)t+=e[Math.floor(Math.random()*e.length)];ia=function(e,t){t=t||0;for(var n=(e=e||"").length%16,r=e.length-n,o=[0,t],a=[0,t],i=[0,0],s=[0,0],c=[2277735313,289559509],l=[1291169091,658871167],u=0;u<r;u+=16)i=[255&e.charCodeAt(u+4)|(255&e.charCodeAt(u+5))<<8|(255&e.charCodeAt(u+6))<<16|(255&e.charCodeAt(u+7))<<24,255&e.charCodeAt(u)|(255&e.charCodeAt(u+1))<<8|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+3))<<24],s=[255&e.charCodeAt(u+12)|(255&e.charCodeAt(u+13))<<8|(255&e.charCodeAt(u+14))<<16|(255&e.charCodeAt(u+15))<<24,255&e.charCodeAt(u+8)|(255&e.charCodeAt(u+9))<<8|(255&e.charCodeAt(u+10))<<16|(255&e.charCodeAt(u+11))<<24],i=ta(i,c),i=na(i,31),i=ta(i,l),o=oa(o,i),o=na(o,27),o=ea(o,a),o=ea(ta(o,[0,5]),[0,1390208809]),s=ta(s,l),s=na(s,33),s=ta(s,c),a=oa(a,s),a=na(a,31),a=ea(a,o),a=ea(ta(a,[0,5]),[0,944331445]);switch(i=[0,0],s=[0,0],n){case 15:s=oa(s,ra([0,e.charCodeAt(u+14)],48));case 14:s=oa(s,ra([0,e.charCodeAt(u+13)],40));case 13:s=oa(s,ra([0,e.charCodeAt(u+12)],32));case 12:s=oa(s,ra([0,e.charCodeAt(u+11)],24));case 11:s=oa(s,ra([0,e.charCodeAt(u+10)],16));case 10:s=oa(s,ra([0,e.charCodeAt(u+9)],8));case 9:s=oa(s,[0,e.charCodeAt(u+8)]),s=ta(s,l),s=na(s,33),s=ta(s,c),a=oa(a,s);case 8:i=oa(i,ra([0,e.charCodeAt(u+7)],56));case 7:i=oa(i,ra([0,e.charCodeAt(u+6)],48));case 6:i=oa(i,ra([0,e.charCodeAt(u+5)],40));case 5:i=oa(i,ra([0,e.charCodeAt(u+4)],32));case 4:i=oa(i,ra([0,e.charCodeAt(u+3)],24));case 3:i=oa(i,ra([0,e.charCodeAt(u+2)],16));case 2:i=oa(i,ra([0,e.charCodeAt(u+1)],8));case 1:i=oa(i,[0,e.charCodeAt(u)]),i=ta(i,c),i=na(i,31),i=ta(i,l),o=oa(o,i)}return o=oa(o,[0,e.length]),a=oa(a,[0,e.length]),o=ea(o,a),a=ea(a,o),o=aa(o),a=aa(a),o=ea(o,a),a=ea(a,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)}(t,31),localStorage.setItem("sczh:bid",ia)};try{ia=localStorage.getItem("sczh:bid")}catch(e){}ia||la();const ua=async(e,t="ja")=>{if(await(async()=>{const e=await Zo("https://api.interpreter.caiyunai.com/v1/page/auth",{cors:!0,method:"POST",headers:{"X-Authorization":"token "+oe.data.cyweb_token,"Content-Type":"application/json"},data:JSON.stringify({browser_id:ia,device_id:"",os_type:"web",title:document.title,url:document.URL,user_id:""})});-1!==e.auth_type&&e.page_id?(ca=!1,sa=e.page_id):(ca=!0,la())})(),ca)return[];const n=await Zo("https://api.interpreter.caiyunai.com/v1/page/translator",{cors:!0,method:"POST",headers:{"X-Authorization":"token "+oe.data.cyweb_token,"Content-Type":"application/json"},data:JSON.stringify({cached:!0,os_type:"web",page_id:sa,replaced:!0,request_id:ia||"",source:e,trans_type:t+"2zh",url:document.URL})});return n&&n.target?n.target.map(e=>e.target):[]};var da=Object.prototype.hasOwnProperty,fa=Array.isArray,pa=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),ha=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n},ma={arrayToObject:ha,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],a=o.obj[o.prop],i=Object.keys(a),s=0;s<i.length;++s){var c=i[s],l=a[c];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:a,prop:c}),n.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(fa(n)){for(var r=[],o=0;o<n.length;++o)void 0!==n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n){if(0===e.length)return e;var r=e;if("symbol"==typeof e?r=Symbol.prototype.toString.call(e):"string"!=typeof e&&(r=String(e)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",a=0;a<r.length;++a){var i=r.charCodeAt(a);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?o+=r.charAt(a):i<128?o+=pa[i]:i<2048?o+=pa[192|i>>6]+pa[128|63&i]:i<55296||i>=57344?o+=pa[224|i>>12]+pa[128|i>>6&63]+pa[128|63&i]:(a+=1,i=65536+((1023&i)<<10|1023&r.charCodeAt(a)),o+=pa[240|i>>18]+pa[128|i>>12&63]+pa[128|i>>6&63]+pa[128|63&i])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(fa(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!da.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var o=t;return fa(t)&&!fa(n)&&(o=ha(t,r)),fa(t)&&fa(n)?(n.forEach((function(n,o){if(da.call(t,o)){var a=t[o];a&&"object"==typeof a&&n&&"object"==typeof n?t[o]=e(a,n,r):t.push(n)}else t[o]=n})),t):Object.keys(n).reduce((function(t,o){var a=n[o];return da.call(t,o)?t[o]=e(t[o],a,r):t[o]=a,t}),o)}},ya=String.prototype.replace,va=/%20/g,ga={RFC1738:"RFC1738",RFC3986:"RFC3986"},wa=ma.assign({default:ga.RFC3986,formatters:{RFC1738:function(e){return ya.call(e,va,"+")},RFC3986:function(e){return String(e)}}},ga),ba=Object.prototype.hasOwnProperty,_a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},Ea=Array.isArray,ka=Array.prototype.push,Sa=function(e,t){ka.apply(e,Ea(t)?t:[t])},xa=Date.prototype.toISOString,ja=wa.default,Aa={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:ma.encode,encodeValuesOnly:!1,format:ja,formatter:wa.formatters[ja],indices:!1,serializeDate:function(e){return xa.call(e)},skipNulls:!1,strictNullHandling:!1},Ia=function e(t,n,r,o,a,i,s,c,l,u,d,f,p){var h,m=t;if("function"==typeof s?m=s(n,m):m instanceof Date?m=u(m):"comma"===r&&Ea(m)&&(m=m.join(",")),null===m){if(o)return i&&!f?i(n,Aa.encoder,p,"key"):n;m=""}if("string"==typeof(h=m)||"number"==typeof h||"boolean"==typeof h||"symbol"==typeof h||"bigint"==typeof h||ma.isBuffer(m))return i?[d(f?n:i(n,Aa.encoder,p,"key"))+"="+d(i(m,Aa.encoder,p,"value"))]:[d(n)+"="+d(String(m))];var y,v=[];if(void 0===m)return v;if(Ea(s))y=s;else{var g=Object.keys(m);y=c?g.sort(c):g}for(var w=0;w<y.length;++w){var b=y[w];a&&null===m[b]||(Ea(m)?Sa(v,e(m[b],"function"==typeof r?r(n,b):n,r,o,a,i,s,c,l,u,d,f,p)):Sa(v,e(m[b],n+(l?"."+b:"["+b+"]"),r,o,a,i,s,c,l,u,d,f,p)))}return v},Ca=(Object.prototype.hasOwnProperty,Array.isArray,function(e,t){var n,r=e,o=function(e){if(!e)return Aa;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||Aa.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=wa.default;if(void 0!==e.format){if(!ba.call(wa.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=wa.formatters[n],o=Aa.filter;return("function"==typeof e.filter||Ea(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:Aa.addQueryPrefix,allowDots:void 0===e.allowDots?Aa.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:Aa.charsetSentinel,delimiter:void 0===e.delimiter?Aa.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:Aa.encode,encoder:"function"==typeof e.encoder?e.encoder:Aa.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:Aa.encodeValuesOnly,filter:o,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:Aa.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:Aa.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:Aa.strictNullHandling}}(t);"function"==typeof o.filter?r=(0,o.filter)("",r):Ea(o.filter)&&(n=o.filter);var a,i=[];if("object"!=typeof r||null===r)return"";a=t&&t.arrayFormat in _a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var s=_a[a];n||(n=Object.keys(r)),o.sort&&n.sort(o.sort);for(var c=0;c<n.length;++c){var l=n[c];o.skipNulls&&null===r[l]||Sa(i,Ia(r[l],l,s,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var u=i.join(o.delimiter),d=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""});const Ma=(e,t,n)=>{t.forEach(t=>{let r=t,o="";for(;r>=0;){r--;let t=e.shift();w(t)&&(t||(t="……"),o+=t+"\n")}o&&n.push(o.slice(0,o.length-1))})},Ra=e=>{let t=[],n=e.map(e=>H(e));return n.forEach(e=>{let n=[...e].filter(e=>"\n"===e).length;t.push(n)}),[n.join("\n"),t]},Oa=(e,t=4e3)=>{let n="",r=[],o=0;return e.split("\n").forEach(e=>{n+=e,o+=new Blob([e]).size,o>t?(r.push(n),o=0,n=""):n+="\n"}),n&&r.push(n.replace(/\n$/,"")),r},Ta=async e=>{try{let[t,n]=Ra(e),r=Oa(t),o=(await Promise.all(r.map(e=>(async e=>{let t=oe.data.language||"zh-CN",n=Ca({client:"gtx",sl:"ja",tl:t,hl:t,ie:"UTF-8",oe:"UTF-8"});["at","bd","ex","ld","md","qca","rw","rm","ss","t"].forEach(e=>{n+="&dt="+e});const r=Ca({q:e});return(e=>{var t;if(null===(t=e[0])||void 0===t?void 0:t.length){return e[0].map(e=>e[0]).join("").split("\n")}return[]})(await Zo("https://translate.google.cn/translate_a/single?"+n,{data:r,method:"POST",headers:{accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8",referer:"https://translate.google.cn",origin:"https://translate.google.cn"}}))})(e)))).reduce((e,t)=>e.concat(t)),a=[];return Ma(o,n,a),a}catch(e){return J(e),[]}},Pa=["text","select","comment","title","actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment","characterComment","producerComment","comment1","comment2"],Da=async e=>{const t=await(async()=>{if(!Bo){let e=await ue("caiyun-prefix");e||(e=await ie("/data/etc/caiyun-prefix.csv"),de("caiyun-prefix",e));const t=ce(e);fe(t,"text").forEach(e=>{const t=U(e.text),n=U(e.fixed);t&&Uo.set(t,n)}),Bo=!0}return Uo})();return Q(e,t)},za=new Map,$a=async(t,n,r,o=!1)=>{if(!t.length)return;const a=await Ko(),i=await Yo(),{textInfo:s,textList:c}=((t,n,r)=>{const o=[],a=[];return t.forEach((t,i)=>{Pa.forEach(s=>{let c=H(t[s]);t[s]&&(n.has(c)?t[s]=e(n.get(c)):r.has(c)?t[s]=e(r.get(c)):(o.push({key:s,index:i}),a.push(c)))})}),{textInfo:o,textList:a}})(t,a,i);if(!s.length)return;const l=n||t;let u=!1,d=[];if(za.has(l))u=!0,d=za.get(l);else{let e=oe.data.trans_api,t=[];if("on"===C.auto&&!o){if("caiyun"===e){let e=await Da(c);t=await(async e=>{try{let t=Y("caiyuLimit");if(t&&Date.now()-t<36e5)return[];let[n,r]=Ra(e),o=Oa(n),a=(await Promise.all(o.map(e=>ua(e.split("\n"))))).reduce((e,t)=>e.concat(t)),i=[];return Ma(a,r,i),i}catch(e){return"Caiyun api out of limit."===e.message&&Y("caiyuLimit",Date.now()),J(e),[]}})(e)}else"google"===e&&(t=await Ta(c));d=await(async e=>{const t=await Lo();return Q(e,t)})(t)}za.set(l,d)}if(!u&&(C.dev||!n||r)){let e=[];c.forEach((t,n)=>{e.push(G(t),d[n])});let t=J;n&&!r||(t=W),t(e.join("\n"))}d.forEach((n,o)=>{let a=n;const{key:i,index:c}=s[o];"select"===i&&(a=((e,t)=>{if(e.length>t&&!e.includes("\n")){const t=Math.floor(e.length/2)+1;return e.slice(0,t)+"\n"+e.slice(t,e.length)}return e})(a,8)),a=a.replace(/"([^"]*)"/g,"“$1”").replace(/'([^']*)'/g,"“$1”").replace(/‘([^']+)'/g,"“$1”"),0!==o||r||(a+=" ☁️"),t[c][i]=e(a)}),(e=>{e.forEach(e=>{e.text&&!e.text.startsWith("​")&&(e.text="‌"+e.text)})})(t)},Fa=async(e,t="comment")=>{if(!e)return;const n=e.map(e=>e[t]).join("").trim();await $a(e,n,!0)},Na=async(e,t="comment")=>{if(!e)return;const n=e.map(e=>e[t]).join("").trim();await $a(e,n,!0,!0)},La=["actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment"],Ua=async e=>{try{if(e.produceAudition){let t=e.produceAudition.judges.map(e=>La.map(t=>e[t]||"").join("")).join("").trim();await $a(e.produceAudition.judges,t,!0)}if(e.produceConcert){let t=e.produceConcert.judges.map(e=>La.map(t=>e[t]||"").join("")).join("").trim();await $a(e.produceConcert.judges,t,!0)}e.produceConcertFanSkillComments&&await Fa(e.produceConcertFanSkillComments,"comment1")}catch(e){J(e)}},Ba=async e=>{if(e.judges){let t=e.judges.map(e=>La.map(t=>e[t]||"").join("")).join("").trim();await $a(e.judges,t,!0)}},Ha=async e=>{if(e.topCharacterReaction)try{const t=[...e.topCharacterReaction.moveReactions,...e.topCharacterReaction.skillReleasedReactions,...e.topCharacterReaction.touchExReactions,...e.topCharacterReaction.touchReactions,...e.topCharacterReaction.waitReactions];await Fa(t)}catch(e){J(e)}},qa=async e=>{let t=[...e.produceStaffComments||[],...e.produceStaffConcertComments||[],...e.produceStaffFailComments||[],...e.produceStaffSeasonComments||[]];await Fa(t)},Ja=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.judges?await Ba(t):await Ua(t),e.gameData=JSON.stringify(t)}catch(e){J(e)}},Wa=async e=>{if(!e.characterComment)return;let t=[];t=t.concat(e.characterComment),await Fa(t)};ur.get([["userProduces",Ha],["fes(Match)?Concert/actions/resume",Ja]]),ur.post([["myPage",async e=>{try{let t=[];e.userHomeDeck.userHomeDeckAnimationMember&&(t=[...e.userHomeDeck.userHomeDeckAnimationMember.mypageComments]);let n=e.userHomeDeck.userHomeAnimationDeck.userHomeAnimationDeckMembers;n&&n.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)}),e.mypageConversations.forEach(e=>{e.mypageConversationComments.forEach(e=>{t.push(e)})})}),e.userHomeDeck.userHomeDeckMembers.length&&e.userHomeDeck.userHomeDeckMembers.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)})}),await Na(t)}catch(e){J(e)}}],["fesTop",async e=>{if(e.userFesDeck)try{let t=[],n=e.userFesDeck.userFesDeckMembers;for(let e of n)e.fesTopCharacterReactions.forEach(e=>{t.push(e)});await Fa(t)}catch(e){J(e)}}],["produces/actions/(resume|next)",[Ha,qa,Ja,Wa,Ua,async e=>{try{var t;await Fa(null===(t=e.produceReporterEvent)||void 0===t?void 0:t.produceReporterEventAnswers,"comment2")}catch(e){J(e)}}]],["produces/actions/endWeek",qa],["produces/actions/act",async e=>{if(!e.lessonResult)return;let t=e.lessonResult;try{let e=[];t.produceActCutinComment&&(e=e.concat(t.produceActCutinComment)),t.produceRestBoostIdolComment&&(e=e.concat(t.produceRestBoostIdolComment)),t.produceRestBoostSupportIdolComment&&(e=e.concat(t.produceRestBoostSupportIdolComment)),t.produceRestComments&&(e=e.concat(t.produceRestComments)),await Fa(e)}catch(e){J(e)}}],["fes(Match|Raid)?Concert/actions/start",Ba],["fes(Match)?Concert/actions/resume",Ja],["fesRaidConcert/actions/resume",async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.judges&&await Ba(t),e.gameState.game_data=JSON.stringify(t)}catch(e){J(e)}}],["produces/actions/result",async e=>{try{let t=e.characterTrustLevelUpComments;await Fa(t)}catch(e){J(e)}}],["produces/({num}/audition|concert)/actions/(start|finish)",[Ua,Wa]],["userProduceHelperSupportIdols",async e=>{try{let t=e.characterComment+e.producerComment;await $a([e],t,!0)}catch(e){J(e)}}]]);ur.get("gashas/{num}/redraws",async e=>{const t=[];e.forEach(e=>{e.comment&&t.push(e.comment)}),await Na(t)}),ur.post([["characterAlbums/characters/{num}",async e=>{const t=[];e.produceIdols.forEach(e=>{e.comment&&t.push(e.comment)}),await Na(t)}],["gashas/{num}/actions/draw",async e=>{var t;const n=[];null===(t=e.gashaDraws)||void 0===t||t.forEach(e=>{e.comment&&n.push(e.comment)}),await Na(n)}]]);ur.post("characterAlbums/characters/{num}",async e=>{if(e.voices){const t=[];e.voices.forEach(e=>{e.characterTrustLevelComment&&t.push(e.characterTrustLevelComment)}),await Na(t)}});const Ga=new Map;let Ka=!1;let Qa=null;async function Va(){const t=await nr("PHRASE");if(t){Qa=await(async(t=!1)=>{if(!Ka){let n=await ue("phrase");n||(n=await ie("/data/phrase.csv"),de("phrase",n));ce(n).forEach(n=>{if(null==n?void 0:n.id){const r=B(n.id),o=B(n.trans,!0);r&&(t?Ga.set(r,n.trans):o&&Ga.set(r,e(o)))}}),Ka=!0}return Ga})();for(let[e,n]of Qa)t[e]=n}}let Ya=new Map,Xa=!1;let Za=new Map,ei=new Map;const ti=[],ni=e=>{e&&e.fontFamily&&(e.fontFamily===O.HEITI_JA?Reflect.set(e,"fontFamily",O.HEITI_TRANS):e.fontFamily===O.YUAN_JA&&Reflect.set(e,"fontFamily",O.YUAN_TRANS))},ri=(e,t,n)=>{let r=e,o=H(e);return t.has(o)?(r="​"+t.get(o),ni(n)):e.startsWith("​")||(e=>{e&&e.fontFamily&&(e.fontFamily===O.HEITI_TRANS?Reflect.set(e,"fontFamily",O.HEITI_JA):e.fontFamily===O.YUAN_TRANS&&Reflect.set(e,"fontFamily",O.YUAN_JA))})(n),r},oi=(e,t,n=!1)=>{if(!w(e))return e;let r=e;return e.startsWith("​")?ni(t):e.trim()&&(n?(r=ri(e,ei,t),r===e&&(e=>{ti.push(e),C.dev,setTimeout(()=>ti.shift(),1e4)})(e)):(e=>{let t=!1;return ti.forEach(n=>{n.startsWith(e)&&(t=!0)}),t})(e)||e.startsWith("‌")||(r=ri(e,Za,t))),r};async function ai(){const e=await nr("AOBA");try{Za=await(async()=>{if(!Xa){let e=await ue("common");e||(e=await ie("/data/common.csv"),de("common",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=B(e.text),n=B(e.trans,!0);t&&n&&t!==n&&Ya.set(t,n)}});const{itemMap:t}=await Ur(),n=await _o();Ya=new Map([...t,...n,...Ya]),Xa=!0}return Ya})(),ei=await Yo()}catch(e){}const t=e.Text.prototype.typeText;e.Text.prototype.typeText=function(...e){const n=e[0];return e[0]=oi(n,this.style,!0),t.apply(this,e)};const n=e.Text.prototype.updateText;e.Text.prototype.updateText=function(e){if(this.localStyleID!==this._style.styleID&&(this.dirty=!0,this._style.styleID),this.dirty||!e){C.dev,0;const t=oi(this._text,this._style);return Reflect.set(this,"_text",t),n.call(this,e)}}}const ii=new Map;let si=!1;let ci=null;const li=async()=>(ci||(ci=(async()=>{if(!si){let e=await ue("image");e||(e=await ie("/data/image.csv"),de("image",e));ce(e).forEach(e=>{if(null==e?void 0:e.name){const t=U(e.name),n=U(e.url),r=U(e.version)||"1";t&&n&&ii.set(t,{url:n,version:r})}}),si=!0}return ii})()),await ci);let ui=!1;async function di(){const e=await nr("AOBA");if(ui)return;e.loaders.Resource.prototype=Object.assign({},e.loaders.Resource.prototype);const t=e.loaders.Resource.prototype._loadElement;e.loaders.Resource.prototype._loadElement=async function(e){C.dev;try{const t=await li();if("image"===e&&t.has(this.name)){const e=t.get(this.name);if(this.url.endsWith("v="+e.version)){const t="image/"+e.url;this.url=`${C.origin}/data/${t}?v=${C.hashes[t]}`,this.crossOrigin=!0}else J("%cimage version not match","color:#fc4175"),J(this.name,this.url)}}catch(e){}return t.call(this,e)},ui=!0}var fi=function(){return i.Date.now()};var pi=function(e){return"symbol"==typeof e||g(e)&&"[object Symbol]"==y(e)},hi=/^\s+|\s+$/g,mi=/^[-+]0x[0-9a-f]+$/i,yi=/^0b[01]+$/i,vi=/^0o[0-7]+$/i,gi=parseInt;var wi=function(e){if("number"==typeof e)return e;if(pi(e))return NaN;if(Re(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Re(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(hi,"");var n=yi.test(e);return n||vi.test(e)?gi(e.slice(2),n?2:8):mi.test(e)?NaN:+e},bi=Math.max,_i=Math.min;var Ei=function(e,t,n){var r,o,a,i,s,c,l=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=o;return r=o=void 0,l=t,i=e.apply(a,n)}function h(e){return l=e,s=setTimeout(y,t),u?p(e):i}function m(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=a}function y(){var e=fi();if(m(e))return v(e);s=setTimeout(y,function(e){var n=t-(e-c);return d?_i(n,a-(e-l)):n}(e))}function v(e){return s=void 0,f&&r?p(e):(r=o=void 0,i)}function g(){var e=fi(),n=m(e);if(r=arguments,o=this,c=e,n){if(void 0===s)return h(c);if(d)return clearTimeout(s),s=setTimeout(y,t),p(c)}return void 0===s&&(s=setTimeout(y,t)),i}return t=wi(t)||0,Re(n)&&(u=!!n.leading,a=(d="maxWait"in n)?bi(wi(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=o=s=void 0},g.flush=function(){return void 0===s?i:v(fi())},g};const ki=`\n  <style>\n  #sczh-story-tool {\n    position: absolute;\n    display: none;\n    background: #ffffff;\n    border-radius: 24px;\n    box-sizing: border-box;\n    font-family: sczh-yuanti;\n    align-items: center;\n    justify-content: center;\n    color: #ff6499;\n    text-shadow: 0 0 6px #fff;\n    cursor: pointer;\n    user-select: none;\n    width: 100px;\n    height: 100px;\n    font-size: 32px;\n    border: 7px solid transparent;\n    border-image: url(${C.origin}/data/image/border.png);\n    border-image-slice: 7;\n    transform-origin: top right;\n    transition: opacity 0.3s;\n  }\n  .story-tool-btns {\n    width: 100%;\n    height: 100%;\n    display: none;\n  }\n  .story-tool-btns .btn-download-sczh,\n  .story-tool-btns label {\n    flex: 1;\n    height: 100%;\n    background: #fff;\n    display: flex;\n    box-sizing: content-box;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    color: #c0aade;\n    text-shadow: 0 0 6px #fff;\n  }\n  .story-tool-btns .btn-download-sczh:hover {\n    color: #9f66ec;\n  }\n  .story-tool-btns label {\n    color: rgb(242, 156, 199);\n    border-right: 1px solid #c9c9c9;\n  }\n  #sczh-story-tool .btn-close-sczh {\n    height: 25px;\n    width: 50px;\n    background: rgba(0, 0, 0, 0.58);\n    color: #fff;\n    letter-spacing: 2px;\n    position: absolute;\n    right: -25px;\n    top: -20px;\n    border-radius: 4px;\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 1;\n    font-family: sczh-heiti;\n    font-size: 15px;\n  }\n  #sczh-story-tool:hover {\n    width: 200px;\n  }\n  #sczh-story-tool:hover .story-tool-btns {\n    display: flex;\n  }\n  #sczh-story-tool:hover .btn-close-sczh {\n    display: flex;\n  }\n  #sczh-story-tool:hover > .text-sczh {\n    display: none;\n  }\n  #sczh-story-tool .btn-close-sczh:hover {\n    background: rgba(0, 0, 0, 0.9);\n  }\n  #sczh-story-tool.blur {\n    opacity: 0.2;\n  }\n  .story-tool-btns label:hover {\n    color: #f270b1;\n  }\n  .story-tool-btns .btn-download-sczh:hover,\n  .story-tool-btns label:hover {\n    background-color: #f7f7f7;\n  }\n  </style>\n  <div id="sczh-story-tool"><span class="text-sczh">剧情</span>\n    <span id="btn-close-sczh" class="btn-close-sczh">关闭</span>\n    <input type="file" style="display:none" id="ipt-preview-sczh" multiple accept=".csv">\n    <div class="story-tool-btns">\n      <label for="ipt-preview-sczh">预览</label>\n      <div id="btn-download-sczh" class="btn-download-sczh">下载</div>\n    </div>\n  </div>\n  `;let Si=!1;const xi=e=>{if(Si)return;Si=!0,document.body.insertAdjacentHTML("beforeend",ki);const t=document.getElementById("sczh-story-tool"),n=Ei(()=>{const n=[.017,.22],r=window.innerHeight,o=window.innerWidth;let a=r,i=o,s=0,c=0;r/o>9/16?(a=9*o/16,s=(r-a)/2):(i=16*r/9,c=(o-i)/2),t.style.right=Math.floor(c+n[0]*i)+"px",t.style.top=Math.floor(s+n[1]*a)+"px",t.style.transform=`scale(${(a/900).toFixed(3)})`,e.name?t.style.display="flex":t.style.display="none"},300);n(),window.addEventListener("resize",n);document.getElementById("btn-download-sczh").addEventListener("click",(function(){if(e.name){((e,t)=>{const n=document.createElement("a");n.download=t,n.style.display="none";const r=new Blob([e],{type:"text/csv"});n.href=URL.createObjectURL(r),document.body.appendChild(n),n.click(),document.body.removeChild(n)})(se.unparse(e.list),e.filename)}}));document.getElementById("btn-close-sczh").addEventListener("click",(function(){t.style.display="none",C.story="normal",z()}));let r;document.getElementById("ipt-preview-sczh").addEventListener("change",(function(){const t=this.files;t.length&&t.forEach(t=>{const n=new FileReader;n.onload=t=>{const n=t.target.result,r=Go(n);if(r.has("name")){const t=r.get("name");e.preview.set(t,r),(e=>{const t=[...e].slice(-5).map(e=>(e[1]=[...e[1]],e));sessionStorage.setItem("sczh:preview",JSON.stringify(t))})(e.preview),alert(`导入${t}成功`)}},n.readAsText(t)})})),t.addEventListener("mouseenter",()=>{clearTimeout(r),t.classList.remove("blur")});const o=()=>{clearTimeout(r),r=setTimeout(()=>{t.classList.add("blur")},5e3)};t.addEventListener("mouseleave",o),o()},ji=new Map,Ai=new Map;let Ii=!1;const Ci=async()=>{if(!Ii){let e=await ue("speaker-icon");e||(e=await ie("/data/speaker-icon.csv"),de("speaker-icon",e));ce(e).forEach(e=>{let{name:t,id:n,type:r}=e;t=U(t),n=U(n),r=U(r),t&&n&&("sub"===r?Ai.set(t,n):ji.set(t,n))}),Ii=!0}return{iconMap:ji,subIconMap:Ai}};let Mi=null;let Ri=!1;const Oi=async()=>{if(Ri)return;Ri=!0;const e=await nr("SPEAKER");if(!e)return W("Speaker-icon module not found.");const{iconMap:n,subIconMap:r}=await Ci(),o=e.getSubCharacterBackLogIconId,a=e.getCharacterBackLogIconId;e.getSubCharacterBackLogIconId=function(e){const n=t(e);return r.has(n)?r.get(n):o.call(this,e)},e.getCharacterBackLogIconId=function(e){const r=t(e);return n.has(r)?n.get(r):a.call(this,e)}},Ti=(e,t)=>{let n=e,r="";return/[0-9０-９]$/.test(e)&&(r=e.match(/([0-9０-９])$/)[1],n=e.slice(0,e.length-1)),t.has(n)?t.get(n)+r:e},Pi=async t=>{if(t.speaker){await Oi();const n=await(async()=>(Mi||(Mi=_o()),await Mi))();let r=U(t.speaker);if(n.has(r))return t.speaker=e(n.get(r));["＆","&"].forEach(e=>{r=((e,t,n)=>{const r=e.split(t);for(let e=0;e<r.length;e++)r[e]=Ti(r[e],n);return r.join(t)})(r,e,n)}),t.speaker=e(r)}},Di={name:"",filename:"",list:"",preview:new Map};let zi=!1;const $i=async()=>{const t=await nr("SCENARIO"),n=t.load;t.load=async function(...t){const r=await n.apply(this,t),o=t[0];if(!o)return r;if(C.dev&&o.includes("/assets/json/")&&rr("STORY","#ad37c2",t,r),o.includes("/produce_events/")||o.includes("/produce_communications/")||o.includes("/produce_communications_promises/")||o.includes("/produce_communication_promise_results/")||o.includes("/game_event_communications/")||o.includes("/special_communications/")||o.includes("/mypage_communications/")||o.includes("/produce_communication_cheers/")||o.includes("/produce_communication_auditions/")||o.includes("/produce_communication_televisions/"))try{if(!Array.isArray(r))return r;const t=o.replace(/^\/assets\/json\//,"");let n;if("edit"===C.story&&(((e,t)=>{const n=t.replace(".json",""),r=(e=>{var t;const n=e.match(/\/(\d+)$/);return null!==(t=null==n?void 0:n[1])&&void 0!==t?t:""})(n);let o=Oo.get(r)||n.replace(/\//g,"_");o=o.replace("​","");const a=[];e.forEach(e=>{let t=U(G(e.text));(null==t?void 0:t.trim())?a.push({id:e.id||"0000000000000",name:e.speaker||"",text:t,trans:""}):e.select&&a.push({id:"select",name:"",text:U(G(e.select)),trans:""})}),a.push({id:"info",name:t,text:"",trans:""}),a.push({id:"译者",name:"",text:"",trans:""}),Di.name=t,Di.filename=o+".csv",Di.list=a})(r,t),xi(Di)),(()=>{if(zi)return;zi=!0;const e=sessionStorage.getItem("sczh:preview");if(e)try{const t=JSON.parse(e),n=new Map(t);for(let[e,t]of n)n.set(e,new Map(t));Di.preview=n}catch(e){J(e)}})(),n=Di.preview.has(t)?Di.preview.get(t):await(async e=>{if(!Wo){let e=await ue("story.json");if(e)Wo=new Map(JSON.parse(e));else{const e=await ie("/story.json");Wo=new Map(e),de("story.json",JSON.stringify(Wo))}}if(Wo.has(e)){if(Ho.has(e))return Ho.get(e);{const t=Wo.get(e),n=await ie(`/data/story/${t}.csv`),r=Go(n);return Ho.set(e,r),r}}return!1})(t),n){((t,n,r)=>{const o=V();t.forEach(t=>{if(t.text){const a=o(t.id),i=H(t.text);n.has(i)?t.text=n.get(i):a&&n.has(""+a)?t.text=n.get(""+a):r.has(i)&&(t.text=e(r.get(i)))}if(t.select){const o=H(t.select),a=o+"-select";n.has(a)?t.select=n.get(a):r.has(o)&&(t.select=e(r.get(t.select)))}})})(r,n,await Ko())}else"on"===C.auto?await $a(r,t):await $a(r,t,!1,!0);for(let e of r)await Pi(e)}catch(e){J(e)}return r}},Fi=e=>{const t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.setAttribute("as","font"),t.setAttribute("type","font/woff2"),t.setAttribute("crossorigin","anonymous"),document.head.appendChild(t)},Ni=(e,t)=>`/data/font/${e}.woff2?v=${t[`font/${e}.woff2`]}`,Li=async()=>{const e=document.createElement("style"),{hashes:t}=await ae;e.innerHTML=`\n  @font-face {\n    font-family: "sczh-heiti";\n    src: url("${C.origin}${Ni("heiti",t)}");\n  }\n  @font-face {\n    font-family: "sczh-yuanti";\n    src: url("${C.origin}${Ni("yuanti",t)}");\n  }\n  ::-webkit-scrollbar {\n    display: none;\n  }\n  `,"yuanti"===C.font1&&Fi(`${C.origin}${Ni("yuanti",t)}`),"heiti"===C.font2&&Fi(`${C.origin}${Ni("heiti",t)}`),document.head.appendChild(e)};window.addEventListener("blur",(function(e){"on"===C.bgm&&e.stopImmediatePropagation()}),!1),document.addEventListener("visibilitychange",(function(e){"on"===C.bgm&&e.stopImmediatePropagation()}));let Ui=0;const Bi=async()=>{var e;Vn||Ui>=300?(async()=>{try{await Promise.all([di(),Li(),Va(),ai(),dr(),$i()])}catch(e){J(e)}})():(await(e=100,new Promise(t=>{setTimeout(t,e)})),Ui++,Ui%10==0&&J(`Waiting: ${Ui/10}s`),await Bi())};"loading"!=document.readyState?Bi():window.unsafeWindow?window.unsafeWindow.addEventListener("DOMContentLoaded",Bi):window.addEventListener("DOMContentLoaded",Bi)}();
